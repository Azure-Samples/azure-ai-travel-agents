<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Polyglot Sanctum - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/Azure-Samples/azure-ai-travel-agents" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Pyramid of Infinite Journeys</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Polyglot Sanctum</h1>
<hr>
<p>In the shadowy depths of the Pyramid of Infinite Journeys lies the Polyglot Sanctum, a hall of interconnected rituals performed by tools forged in diverse tongues. Here, the Codexians mastered the art of harmonizing disparate languages to achieve unified orchestration. The sanctum challenges you to uncover how these tools‚Äîcrafted in Python, Java, and TypeScript‚Äîwork in concert, bound by the sacred Model Context Protocol (MCP). Your task is to decode the ancient glyphs of polyglot services and reveal the secrets of their dynamic interactions.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Tool Invocation Rites</strong>: How do the <code class="inline-code">@Tool</code> annotations in Java and Python define the rituals (tools) for interaction in the MCP ecosystem?</li>
<li>‚ö° <strong>Polyglot Coordination</strong>: How are tools written in different languages (e.g., Java, Python, TypeScript) interconnected and orchestrated through MCP?</li>
<li>üõ°Ô∏è <strong>Resilience of Invocation</strong>: What mechanisms exist in the tools to handle invalid inputs or errors during invocation?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java" target="_blank" rel="noopener noreferrer">src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java</a>:</span> Java-based destination recommendation service</h3>
<p>This file defines the <code class="inline-code">DestinationService</code>, a Java class with annotated methods that act as MCP tools. These tools provide travel recommendations based on various criteria such as activity type, budget, or season. The <code class="inline-code">@Tool</code> annotations expose these methods to the MCP framework, enabling dynamic invocation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">echoMessage</code>: A simple tool to echo back an input message, useful for debugging and verifying connectivity.</li>
<li><code class="inline-code">getDestinationsByActivity</code>: Recommends destinations based on activity type, with validation for predefined activity categories.</li>
<li><code class="inline-code">getDestinationsByPreferences</code>: A comprehensive tool that combines multiple preferences (activity, budget, season) to suggest destinations.</li>
</ul>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts" target="_blank" rel="noopener noreferrer">src/tools/echo-ping/src/server.ts</a>:</span> TypeScript-based echo MCP server</h3>
<p>This file implements an MCP server in TypeScript. It uses the <code class="inline-code">@modelcontextprotocol/sdk</code> library to handle incoming requests, dynamically list tools, and execute them.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupServerRequestHandlers</code>: Configures handlers for listing and invoking tools.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts#L37" target="_blank" rel="noopener noreferrer"><code class="inline-code">handlePostRequest</code></a>: Processes incoming MCP requests and routes them to the appropriate tool.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts#L137" target="_blank" rel="noopener noreferrer"><code class="inline-code">createRPCErrorResponse</code></a>: Generates structured error responses for invalid or failed tool invocations.</li>
</ul>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a>:</span> Python-based itinerary planning MCP server</h3>
<p>This file defines the <code class="inline-code">FastMCP</code> server for itinerary planning, written in Python. It provides tools to suggest hotels and flights based on user input, with robust input validation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">suggest_hotels</code>: Suggests hotels based on location and dates, with validation for ISO date formats.</li>
<li><code class="inline-code">suggest_flights</code>: Suggests flights based on departure and return dates, handling direct and connecting flights.</li>
<li><code class="inline-code">validate_iso_date</code>: Ensures date inputs conform to ISO standards, preventing invalid input errors.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java" target="_blank" rel="noopener noreferrer">src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java</a></h3>
<pre><code class="language-java">@Tool(description = &quot;Echo back the input message exactly as received&quot;)
public String echoMessage(String message) {
    return message;
}

@Tool(description = &quot;Get travel destination recommendations based on preferred activity type&quot;)
public String getDestinationsByActivity(String activityType) {
    try {
        String activity = activityType.toUpperCase();
        if (!isValidActivityType(activity)) {
            return &quot;Invalid activity type. Please use one of: BEACH, ADVENTURE, CULTURAL, RELAXATION, URBAN_EXPLORATION, NATURE, WINTER_SPORTS&quot;;
        }
        return getDestinationsByPreference(activity, null, null, null);
    } catch (Exception e) {
        return &quot;Invalid activity type.&quot;;
    }
}

@Tool(description = &quot;Get travel destination recommendations based on multiple criteria&quot;)
public String getDestinationsByPreferences(String activity, String budget, String season, Boolean familyFriendly) {
    try {
        if (activity != null &amp;&amp; !isValidActivityType(activity.toUpperCase())) {
            return &quot;Invalid activity type.&quot;;
        }
        return getDestinationsByPreference(activity, budget, season, familyFriendly);
    } catch (Exception e) {
        return &quot;Invalid input.&quot;;
    }
}
</code></pre>
<ul>
<li><code class="inline-code">echoMessage</code> demonstrates a simple tool invocation, useful for debugging.</li>
<li><code class="inline-code">getDestinationsByActivity</code> validates the input and provides tailored recommendations, showcasing error handling.</li>
<li><code class="inline-code">getDestinationsByPreferences</code> integrates multiple criteria, highlighting the flexibility of MCP tools.</li>
</ul>
<hr>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts" target="_blank" rel="noopener noreferrer">src/tools/echo-ping/src/server.ts</a></h3>
<pre><code class="language-typescript">private setupServerRequestHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async (_request) =&gt; {
        return {
            jsonrpc: JSON_RPC,
            tools: EchoTools,
        };
    });
    this.server.setRequestHandler(
        CallToolRequestSchema,
        async (request, _extra) =&gt; {
            const toolName = request.params.name;
            const tool = EchoTools.find((tool) =&gt; tool.name === toolName);
            if (!tool) {
                return this.createRPCErrorResponse(`Tool ${toolName} not found.`);
            }
            try {
                const result = await tool.execute(request.params.arguments);
                return {
                    jsonrpc: JSON_RPC,
                    content: [{ type: &#39;text&#39;, text: JSON.stringify(result) }],
                };
            } catch (error) {
                return this.createRPCErrorResponse(`Error executing tool ${toolName}: ${error}`);
            }
        }
    );
}
</code></pre>
<ul>
<li><code class="inline-code">setupServerRequestHandlers</code> dynamically binds tools to the MCP server, enabling runtime tool discovery.</li>
<li>Error handling in <code class="inline-code">CallToolRequestSchema</code> ensures robustness when tools are missing or fail during execution.</li>
<li>The use of JSON-RPC ensures consistent communication and error reporting.</li>
</ul>
<hr>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a></h3>
<pre><code class="language-python">@mcp.tool()
async def suggest_hotels(location: str, check_in: str, check_out: str) -&gt; HotelSuggestions:
    check_in_date = validate_iso_date(check_in, &quot;check_in&quot;)
    check_out_date = validate_iso_date(check_out, &quot;check_out&quot;)
    if check_out_date &lt;= check_in_date:
        raise ValueError(&quot;check_out date must be after check_in date&quot;)
    hotels = [Hotel(name=&quot;Luxury Inn&quot;, rating=4.5, price_per_night=300, location=location)]
    return HotelSuggestions(hotels=hotels)

def validate_iso_date(date_str: str, param_name: str) -&gt; datetime.date:
    iso_pattern = re.compile(r&quot;^\d{4}-\d{2}-\d{2}{{QUEST_CONTENT}}quot;)
    if not iso_pattern.match(date_str):
        raise ValueError(f&quot;{param_name} must be in ISO format (YYYY-MM-DD)&quot;)
    return datetime.strptime(date_str, &quot;%Y-%m-%d&quot;).date()
</code></pre>
<ul>
<li><code class="inline-code">suggest_hotels</code> provides a robust tool for hotel suggestions, with strict input validation.</li>
<li><code class="inline-code">validate_iso_date</code> ensures input integrity, preventing runtime errors from invalid dates.</li>
<li>The use of Python dataclasses simplifies the representation of complex data structures like hotels.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When exploring <code class="inline-code">DestinationService</code>, focus on how <code class="inline-code">@Tool</code> annotations expose methods to the MCP framework.</li>
<li>In <code class="inline-code">server.ts</code>, observe how <code class="inline-code">setupServerRequestHandlers</code> dynamically maps tools, enabling flexibility.</li>
<li>Examine <code class="inline-code">validate_iso_date</code> in <code class="inline-code">mcp_server.py</code> to understand how input validation safeguards tool execution.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the Pyramid of Infinite Journeys.</p>
<p>By the sacred flame of the oracle, thou hast unlocked the tongues of the ancients within the hallowed Polyglot Sanctum‚Äîpress onward, seeker of wisdom, for the stars yet hold thy final triumph! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>