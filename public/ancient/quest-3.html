<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Glyphs of Discovery - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/Azure-Samples/azure-ai-travel-agents" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Sacred Codex of the Azure Agents</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Adventure</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Glyphs of Discovery</h1>
<hr>
<p>Deep within the Temple of Azure lies the Hall of Glyphs, a chamber adorned with ancient inscriptions that reveal the secrets of interconnected tools. These glyphs, etched by the civilization‚Äôs wisest sages, describe how the Codex of Orchestration communicates with mystical agents scattered across the lands. To unlock the full potential of this ancient network, adventurers must decipher the rituals of the Model Context Protocol (MCP), learning how tools are dynamically discovered and seamlessly integrated into the Codex&#39;s workflow.</p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:</p>
<ul>
<li>üéØ <strong>MCP Protocol Integration</strong>: How MCP enables dynamic discovery and interaction with tools across diverse technologies.</li>
<li>üîç <strong>Tool Communication Patterns</strong>: The significance of HTTP and SSE-based transports in managing tool connectivity and notifications.</li>
<li>‚ö° <strong>Dynamic Tool Discovery</strong>: How tools are registered, validated, and utilized within the Codex&#39;s orchestration system.</li>
<li>üí° <strong>Error Handling Strategies</strong>: Techniques for managing unreachable tools and ensuring system resilience.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-http-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/api/src/mcp/mcp-http-client.ts</code></a></h3>
<p>This file implements the <code class="inline-code">MCPClient</code>, which uses HTTP transport to connect with MCP servers. It handles tool discovery, execution, and notifications by leveraging the Model Context Protocol SDK. The HTTP-based client is a modern implementation designed for reliable and scalable tool interaction.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L39" target="_blank" rel="noopener noreferrer"><code class="inline-code">connect</code></a>: Establishes a connection to the MCP server using HTTP transport.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L57" target="_blank" rel="noopener noreferrer"><code class="inline-code">listTools</code></a>: Retrieves available tools from the MCP server, enabling dynamic discovery.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L68" target="_blank" rel="noopener noreferrer"><code class="inline-code">callTool</code></a>: Executes a specific tool with provided arguments, facilitating interaction with specialized agents.</li>
<li><code class="inline-code">setNotificationHandler</code>: Registers handlers for server-side notifications, such as tool list updates.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">async connect() {
  await this.client.connect(this.transport);
  console.log(&#39;Connected to server&#39;);
}
</code></pre>
<ul>
<li>Establishes a connection using HTTP transport for reliable communication.</li>
<li>Ensures the client is initialized before interacting with tools.</li>
<li>Logs the connection status for monitoring and debugging purposes.</li>
</ul>
<hr>
<pre><code class="language-typescript">async listTools() {
  const result = await this.client.listTools();
  return result.tools;
}
</code></pre>
<ul>
<li>Retrieves the list of tools available on the MCP server.</li>
<li>Enables dynamic discovery of tools, critical for flexible workflows.</li>
<li>Demonstrates clean async handling for server interaction.</li>
</ul>
<hr>
<pre><code class="language-typescript">async callTool(name: string, toolArgs: string) {
  console.log(`Calling tool ${name} with arguments:`, toolArgs);

  return await this.client.callTool({
    name,
    arguments: JSON.parse(toolArgs),
  });
}
</code></pre>
<ul>
<li>Executes a specific tool with serialized arguments.</li>
<li>Ensures compatibility with JSON-based transport protocols.</li>
<li>Provides console logging for traceability during tool execution.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/api/src/mcp/mcp-sse-client.ts</code></a></h3>
<p>This file provides an alternative implementation of <code class="inline-code">MCPClient</code> using Server-Sent Events (SSE) for real-time communication. Although considered legacy, the SSE-based client demonstrates how tools can interact with MCP servers dynamically while maintaining a persistent connection.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L39" target="_blank" rel="noopener noreferrer"><code class="inline-code">connect</code></a>: Establishes a persistent SSE connection to receive real-time updates.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L57" target="_blank" rel="noopener noreferrer"><code class="inline-code">listTools</code></a>: Retrieves tools from the MCP server, similar to the HTTP client.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L68" target="_blank" rel="noopener noreferrer"><code class="inline-code">callTool</code></a>: Executes tools with real-time feedback via SSE transport.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L84" target="_blank" rel="noopener noreferrer"><code class="inline-code">cleanup</code></a>: Closes the SSE connection gracefully, ensuring resource management.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">connect() {
  return tracer.startActiveSpan(&quot;connect&quot;, async (span) =&gt; {
    log(&quot;Connecting to MCP SSE server&quot;);
    try {
      await this.client.connect(this.transport);
      log(&quot;Connected to MCP SSE server&quot;);
      span.end();
      return this.client;
    } catch (error: any) {
      log(&quot;Error connecting to MCP SSE server:&quot;, error);
      span.setStatus({ code: 2, message: (error as Error).message });
      span.end();
      throw new Error(
        `Failed to connect to MCP SSE server: ${(error as Error).message}`
      );
    }
  });
}
</code></pre>
<ul>
<li>Uses OpenTelemetry for tracing connection lifecycle, providing observability.</li>
<li>Implements robust error handling for connection failures.</li>
<li>Demonstrates real-time transport initialization.</li>
</ul>
<hr>
<pre><code class="language-typescript">async listTools() {
  return tracer.startActiveSpan(&quot;listTools&quot;, async (span) =&gt; {
    log(&quot;Tools&quot;, this.tools);
    const toolsResult = await this.client.listTools();
    this.tools = toolsResult.tools;
    log(&quot;Tools: &quot;, toolsResult);
    span.end();
    return toolsResult;
  });
}
</code></pre>
<ul>
<li>Retrieves tool information while maintaining observability through tracing.</li>
<li>Updates local tool cache for efficient reuse.</li>
<li>Highlights asynchronous patterns for real-time data retrieval.</li>
</ul>
<hr>
<pre><code class="language-typescript">async cleanup() {
  await this.transport.close();
}
</code></pre>
<ul>
<li>Gracefully terminates the SSE connection to free resources.</li>
<li>Ensures proper cleanup of transport mechanisms.</li>
<li>Demonstrates best practices for resource management.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/api/src/mcp/mcp-tools.ts</code></a></h3>
<p>This file orchestrates MCP tool discovery and initialization by leveraging both HTTP and SSE-based clients. It defines the <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L19" target="_blank" rel="noopener noreferrer"><code class="inline-code">client</code></a> function to dynamically select the appropriate transport based on configuration and the <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L31" target="_blank" rel="noopener noreferrer"><code class="inline-code">mcpToolsList</code></a> function to aggregate tool information across multiple servers.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">client(config)</code>: Dynamically initializes MCP clients based on transport type (HTTP or SSE).</li>
<li><code class="inline-code">mcpToolsList(config)</code>: Aggregates tool information from multiple MCP servers, enabling comprehensive discovery.</li>
<li><code class="inline-code">McpServerDefinition</code>: Provides a structured configuration for MCP servers, ensuring consistency.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">function client(config: LlamaIndexMCPClientOptions): MCPSSEClient | MCPHTTPClient {
  console.log(`Initializing MCP client`);
  console.log(`Using configuration:`, {config});

  if (config.type === &quot;sse&quot;) {
    // legacy implementation using SSE
    return new MCPSSEClient(&quot;llamaindex-sse-client&quot;, config.url, config.accessToken);
  } else {
    return new MCPHTTPClient(&quot;llamaindex-http-client&quot;, config.url, config.accessToken);
  }
}
</code></pre>
<ul>
<li>Dynamically selects the appropriate client based on transport type.</li>
<li>Demonstrates extensibility by supporting multiple protocols.</li>
<li>Ensures backward compatibility with legacy implementations.</li>
</ul>
<hr>
<pre><code class="language-typescript">export async function mcpToolsList(config: McpServerDefinition[]) {
  return await Promise.all(
    config.map(async ({ id, name, config }) =&gt; {
      const { url, type } = config;
      const mcpClient = client(config);
      
      try {
        console.log(`Connecting to MCP server ${name} at ${url}`);
        await mcpClient.connect();
        console.log(`MCP server ${name} is reachable`);
        const tools = await mcpClient.listTools();

        console.log(`MCP server ${name} has ${tools.length} tools`);
        return {
          id,
          name,
          url,
          type,
          reachable: true,
          selected: id !== &quot;echo-ping&quot;,
          tools,
        };
      } catch (error: unknown) {
        console.error(
          `MCP server ${name} is not reachable`,
          (error as Error).message
        );
        return {
          id,
          name,
          url,
          type,
          reachable: false,
          selected: false,
          tools: [],
          error: (error as Error).message,
        };
      }
    })
  );
}
</code></pre>
<ul>
<li>Aggregates tool information from multiple MCP servers.</li>
<li>Implements robust error handling for unreachable servers.</li>
<li>Demonstrates parallel processing for efficient tool discovery.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Study how <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L39" target="_blank" rel="noopener noreferrer"><code class="inline-code">connect</code></a> methods differ between HTTP and SSE transports to understand their use cases.</li>
<li>Observe how <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L31" target="_blank" rel="noopener noreferrer"><code class="inline-code">mcpToolsList</code></a> uses parallel processing to improve discovery efficiency.</li>
<li>Pay attention to tracing patterns in the SSE client for monitoring distributed systems.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:</p>
<ol>
<li><strong>Add a New MCP Server</strong>: Implement a new MCP server using Python that provides weather information. Register it using the <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L31" target="_blank" rel="noopener noreferrer"><code class="inline-code">mcpToolsList</code></a> function and test tool discovery.</li>
<li><strong>Trace Tool Execution</strong>: Add logging within the <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L68" target="_blank" rel="noopener noreferrer"><code class="inline-code">callTool</code></a> method to trace arguments and results. Analyze how data flows through the system during tool invocation.</li>
<li><strong>Experiment with Error Handling</strong>: Modify the error handling in <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L31" target="_blank" rel="noopener noreferrer"><code class="inline-code">mcpToolsList</code></a> to retry unreachable servers. Test how retries improve tool discovery reliability.</li>
</ol>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries hidden within the Temple of Azure.</p>
<p>Hail, seeker of wisdom, for thou hast unveiled the sacred Glyphs of Discovery, etching thy name upon the eternal tablets of knowledge‚Äîpress onward, for the stars themselves bear witness to thy luminous ascent! ‚≠ê‚ö°üìú</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>