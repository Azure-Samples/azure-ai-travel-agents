<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Polyglot Starbase Operations - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/Azure-Samples/azure-ai-travel-agents" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Galactic Alliance: The AI Voyager Initiative</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Polyglot Starbase Operations</h1>
<hr>
<p>The AI Voyager Initiative has reached a bustling polyglot starbase where diverse MCP services converge. Your mission is to ensure seamless collaboration between multi-language MCP tools that power interstellar operations. With Java, Python, and TypeScript services working in unison, the Voyager&#39;s crew must synchronize these tools to decode alien signals, plan itineraries, and provide stellar recommendations. LlamaIndex acts as the orchestrator, while the MCP protocol bridges the gap across languages. Dive into the intricacies of this polyglot architecture and ensure the starbase operates flawlessly!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Interstellar Tool Mapping</strong>: How are tools defined and exposed for the MCP protocol across different languages, and what patterns ensure consistency?</li>
<li>‚ö° <strong>Cross-Language Collaboration</strong>: How does the architecture enable seamless communication between Python, Java, and TypeScript services?</li>
<li>üõ°Ô∏è <strong>Error Handling in the Cosmos</strong>: What error handling mechanisms are implemented to ensure robust and fault-tolerant operations across the polyglot MCP services?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a>:</span> Python Service for Itinerary Planning</h3>
<p>This file implements a Python-based MCP server for itinerary planning. It provides tools to suggest flights and hotels based on user inputs, leveraging the <code class="inline-code">FastMCP</code> framework. The service validates inputs, generates mock data for flights and hotels, and ensures robust error handling for invalid parameters.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">suggest_hotels</code>: Suggests hotels based on location and dates, with validation for ISO date formats and mock data generation.</li>
<li><code class="inline-code">suggest_flights</code>: Provides flight recommendations, including direct and connecting flights, with detailed mock data.</li>
<li><code class="inline-code">validate_iso_date</code>: Ensures date inputs are in the correct ISO format and raises errors for invalid values.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a></h3>
<pre><code class="language-python">@mcp.tool()
async def suggest_hotels(
    location: Annotated[str, Field(description=&quot;Location (city or area) to search for hotels&quot;)],
    check_in: Annotated[str, Field(description=&quot;Check-in date in ISO format (YYYY-MM-DD)&quot;)],
    check_out: Annotated[str, Field(description=&quot;Check-out date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; HotelSuggestions:
    # Validate dates
    check_in_date = validate_iso_date(check_in, &quot;check_in&quot;)
    check_out_date = validate_iso_date(check_out, &quot;check_out&quot;)
    if check_out_date &lt;= check_in_date:
        raise ValueError(&quot;check_out date must be after check_in date&quot;)

    # Generate mock hotel data
    hotels = [
        Hotel(
            name=f&quot;Hotel {i}&quot;,
            address=fake.street_address(),
            location=location,
            rating=random.uniform(3.0, 5.0),
            price_per_night=random.randint(100, 500),
            hotel_type=&quot;Luxury&quot;,
            amenities=[&quot;WiFi&quot;, &quot;Pool&quot;],
            available_rooms=random.randint(1, 10),
        )
        for i in range(5)
    ]
    return HotelSuggestions(hotels=hotels)
</code></pre>
<ul>
<li>Validates user inputs for location and date formats, ensuring robust error handling.</li>
<li>Generates mock hotel data dynamically, simulating real-world scenarios.</li>
<li>Demonstrates the use of Python&#39;s <code class="inline-code">dataclass</code> for structured data representation.</li>
</ul>
<hr>
<pre><code class="language-python">@mcp.tool()
async def suggest_flights(
    from_location: Annotated[str, Field(description=&quot;Departure location (city or airport)&quot;)],
    to_location: Annotated[str, Field(description=&quot;Destination location (city or airport)&quot;)],
    departure_date: Annotated[str, Field(description=&quot;Departure date in ISO format (YYYY-MM-DD)&quot;)],
    return_date: Annotated[str, Field(description=&quot;Return date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; FlightSuggestions:
    # Validate and parse dates
    dep_date = validate_iso_date(departure_date, &quot;departure_date&quot;)
    ret_date = validate_iso_date(return_date, &quot;return_date&quot;)
    if ret_date &lt;= dep_date:
        raise ValueError(&quot;return_date must be after departure_date&quot;)

    # Generate mock flight data
    flights = [
        Flight(
            flight_id=str(uuid.uuid4()),
            airline=&quot;Starline Airways&quot;,
            flight_number=&quot;SL123&quot;,
            from_airport=Airport(code=&quot;ABC&quot;, name=&quot;Alpha Station&quot;),
            to_airport=Airport(code=&quot;XYZ&quot;, name=&quot;Zeta Station&quot;),
            departure=dep_date.isoformat(),
            arrival=(dep_date + timedelta(hours=5)).isoformat(),
            duration_minutes=300,
            is_direct=True,
            price=299.99,
            currency=&quot;USD&quot;,
            available_seats=20,
            cabin_class=&quot;Economy&quot;,
            segments=[],
            connection=None,
        )
    ]
    return FlightSuggestions(departure_flights=flights, return_flights=flights)
</code></pre>
<ul>
<li>Handles both departure and return flights with detailed mock data generation.</li>
<li>Simulates flight connections and direct flights, showcasing complex data modeling.</li>
<li>Implements robust validation for date inputs and ensures logical consistency.</li>
</ul>
<hr>
<pre><code class="language-python">def validate_iso_date(date_str: str, param_name: str) -&gt; datetime.date:
    iso_pattern = re.compile(r&quot;^\d{4}-\d{2}-\d{2}{{QUEST_CONTENT}}quot;)
    if not iso_pattern.match(date_str):
        raise ValueError(f&quot;{param_name} must be in ISO format (YYYY-MM-DD), got: {date_str}&quot;)
    return datetime.strptime(date_str, &quot;%Y-%m-%d&quot;).date()
</code></pre>
<ul>
<li>Ensures that date inputs conform to the ISO 8601 standard.</li>
<li>Raises descriptive errors for invalid formats, aiding debugging and user feedback.</li>
<li>Centralizes validation logic for reuse across tools.</li>
</ul>
<hr>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/McpServerApplication.java" target="_blank" rel="noopener noreferrer">src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/McpServerApplication.java</a>:</span> Java Service Initialization</h3>
<p>This file initializes the Java-based MCP server for destination recommendations. It uses Spring Boot to define application configuration and exposes tools via the <code class="inline-code">ToolCallbackProvider</code>.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">main</code>: Launches the Spring Boot application, initializing the MCP server.</li>
<li><code class="inline-code">destinationTools</code>: Registers <code class="inline-code">DestinationService</code> tools for MCP discovery.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/McpServerApplication.java" target="_blank" rel="noopener noreferrer">src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/McpServerApplication.java</a></h3>
<pre><code class="language-java">@SpringBootApplication
public class McpServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(McpServerApplication.class, args);
    }
    
    @Bean
    public ToolCallbackProvider destinationTools(DestinationService destinationService) {
        return MethodToolCallbackProvider.builder().toolObjects(destinationService).build();
    }
}
</code></pre>
<ul>
<li>The <code class="inline-code">main</code> method serves as the entry point for the Java MCP server.</li>
<li>The <code class="inline-code">destinationTools</code> bean dynamically registers tools, enabling their discovery by the MCP protocol.</li>
<li>Uses Spring Boot annotations (<code class="inline-code">@SpringBootApplication</code>, <code class="inline-code">@Bean</code>) for declarative configuration.</li>
</ul>
<hr>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts" target="_blank" rel="noopener noreferrer">src/tools/echo-ping/src/server.ts</a>:</span> TypeScript Echo MCP Service</h3>
<p>This file implements a TypeScript-based MCP server that provides an echo service. It demonstrates how to handle requests, manage tools, and implement error handling in a TypeScript environment.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupServerRequestHandlers</code>: Configures request handlers for MCP tools and error responses.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts#L37" target="_blank" rel="noopener noreferrer"><code class="inline-code">handlePostRequest</code></a>: Processes POST requests, including tool execution and error handling.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts#L137" target="_blank" rel="noopener noreferrer"><code class="inline-code">createRPCErrorResponse</code></a>: Generates consistent JSON-RPC error responses.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts" target="_blank" rel="noopener noreferrer">src/tools/echo-ping/src/server.ts</a></h3>
<pre><code class="language-typescript">private setupServerRequestHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async (_request) =&gt; {
        return {
            jsonrpc: JSON_RPC,
            tools: EchoTools,
        };
    });
    this.server.setRequestHandler(CallToolRequestSchema, async (request, _extra) =&gt; {
        const toolName = request.params.name;
        const tool = EchoTools.find((tool) =&gt; tool.name === toolName);
        if (!tool) {
            return this.createRPCErrorResponse(`Tool ${toolName} not found.`);
        }
        try {
            const result = await tool.execute(request.params.arguments);
            return {
                jsonrpc: JSON_RPC,
                content: [{ type: &#39;text&#39;, text: `Result: ${result}` }],
            };
        } catch (error) {
            return this.createRPCErrorResponse(`Error executing tool ${toolName}: ${error}`);
        }
    });
}
</code></pre>
<ul>
<li>Dynamically lists available tools and handles tool execution requests.</li>
<li>Implements error handling for missing tools and execution failures.</li>
<li>Demonstrates TypeScript&#39;s strong typing and asynchronous patterns.</li>
</ul>
<hr>
<pre><code class="language-typescript">async handlePostRequest(req: Request, res: Response) {
    try {
        const transport = new StreamableHTTPServerTransport({ sessionIdGenerator: undefined });
        await this.server.connect(transport);
        await transport.handleRequest(req, res, req.body);
    } catch (error) {
        if (!res.headersSent) {
            res.status(500).json(this.createRPCErrorResponse(&#39;Internal server error.&#39;));
        }
    }
}
</code></pre>
<ul>
<li>Processes incoming POST requests, connecting transports to the MCP server.</li>
<li>Ensures robust error handling for unexpected failures.</li>
<li>Uses the <code class="inline-code">StreamableHTTPServerTransport</code> for efficient request handling.</li>
</ul>
<hr>
<pre><code class="language-typescript">private createRPCErrorResponse(message: string): JSONRPCError {
    return {
        jsonrpc: JSON_RPC,
        error: { code: JSON_RPC_ERROR, message: message },
        id: randomUUID(),
    };
}
</code></pre>
<ul>
<li>Standardizes error responses for JSON-RPC requests.</li>
<li>Simplifies debugging by providing descriptive error messages.</li>
<li>Ensures consistent error handling across the server.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üõ∞Ô∏è <strong>Tool Discovery</strong>: Observe how tools are registered and exposed in each language to understand cross-language consistency.</li>
<li>üåå <strong>Validation Patterns</strong>: Study the input validation techniques to ensure robust and error-free operations.</li>
<li>üöÄ <strong>Error Responses</strong>: Pay attention to error handling mechanisms, especially in the TypeScript server, for insights into fault-tolerant design.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the AI Voyager Initiative.</p>
<p>Stellar work navigating the linguistic nebula of Quest 4: Polyglot Starbase Operations‚Äîyour cosmic fluency is powering this mission at warp speed toward the final frontier! üöÄ‚≠êüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>