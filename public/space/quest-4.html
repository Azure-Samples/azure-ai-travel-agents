<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polyglot Stellar Services - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/Azure-Samples/azure-ai-travel-agents" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Galactic Mission: The Orchestrator's Odyssey</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Polyglot MCP Services Architecture</h1>
<hr>
<p>The <em>Llama Voyager</em> has reached a critical juncture in its journey through the Andromeda Galaxy. To navigate the complexities of interstellar travel, the crew must rely on a polyglot network of MCP (Model Context Protocol) services. These services, developed in multiple languages, provide specialized tools for itinerary planning, destination recommendations, and echo-based diagnostics. Your mission is to explore how these diverse services work together seamlessly, powered by the MCP protocol, to ensure the starship‚Äôs systems operate in perfect harmony.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Service Interoperability</strong>: How do polyglot services communicate effectively using the MCP protocol?</li>
<li>‚ö° <strong>Tool Registration</strong>: What mechanisms are used to register and expose tools within each service?</li>
<li>üõ°Ô∏è <strong>Error Handling Across Languages</strong>: How do different services handle invalid inputs or unexpected errors?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a>:</span> Python MCP Service for Itinerary Planning</h3>
<p>This file implements a FastMCP server in Python, designed to suggest hotels and flights based on user input. It demonstrates the use of Pydantic for input validation and generates realistic mock data for travel planning. The service showcases how Python‚Äôs asynchronous capabilities and data modeling can create a robust MCP tool.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">suggest_hotels</code>: Suggests hotels based on location and dates, validating inputs and generating mock data.</li>
<li><code class="inline-code">suggest_flights</code>: Provides flight suggestions, including handling direct and connecting flights with detailed segments.</li>
<li><code class="inline-code">validate_iso_date</code>: Validates ISO-formatted dates, ensuring proper input for travel queries.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a></h3>
<pre><code class="language-python">@mcp.tool()
async def suggest_hotels(
    location: Annotated[str, Field(description=&quot;Location (city or area) to search for hotels&quot;)],
    check_in: Annotated[str, Field(description=&quot;Check-in date in ISO format (YYYY-MM-DD)&quot;)],
    check_out: Annotated[str, Field(description=&quot;Check-out date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; HotelSuggestions:
    &quot;&quot;&quot;
    Suggest hotels based on location and dates.
    &quot;&quot;&quot;
    # Validate dates
    check_in_date = validate_iso_date(check_in, &quot;check_in&quot;)
    check_out_date = validate_iso_date(check_out, &quot;check_out&quot;)

    # Ensure check_out is after check_in
    if check_out_date &lt;= check_in_date:
        raise ValueError(&quot;check_out date must be after check_in date&quot;)

    # Create realistic mock data for hotels
    hotel_types = [&quot;Luxury&quot;, &quot;Boutique&quot;, &quot;Budget&quot;, &quot;Business&quot;]
    amenities = [&quot;Free WiFi&quot;, &quot;Pool&quot;, &quot;Spa&quot;, &quot;Gym&quot;, &quot;Restaurant&quot;, &quot;Bar&quot;, &quot;Room Service&quot;, &quot;Parking&quot;]

    # Generate between 3 and 8 hotels
    hotels = [
        Hotel(
            name=f&quot;{random.choice(hotel_types)} Hotel&quot;,
            address=fake.street_address(),
            location=f&quot;{location}&quot;,
            rating=round(random.uniform(3.0, 5.0), 1),
            price_per_night=random.randint(80, 500),
            hotel_type=random.choice(hotel_types),
            amenities=random.sample(amenities, random.randint(3, 6)),
            available_rooms=random.randint(1, 15),
        )
        for _ in range(random.randint(3, 8))
    ]

    # Sort by rating to show best hotels first
    hotels.sort(key=lambda x: x.rating, reverse=True)
    return HotelSuggestions(hotels=hotels)
</code></pre>
<ul>
<li>Validates inputs using Pydantic and custom logic to ensure data integrity.</li>
<li>Generates realistic mock data for hotels, simulating a real-world API response.</li>
<li>Demonstrates asynchronous programming with <code class="inline-code">async def</code> for scalable service handling.</li>
<li>Highlights modularity by separating validation, data generation, and response construction.</li>
<li>Uses Python‚Äôs random and Faker libraries for dynamic data creation.</li>
</ul>
<hr>
<pre><code class="language-python">@mcp.tool()
async def suggest_flights(
    from_location: Annotated[str, Field(description=&quot;Departure location (city or airport)&quot;)],
    to_location: Annotated[str, Field(description=&quot;Destination location (city or airport)&quot;)],
    departure_date: Annotated[str, Field(description=&quot;Departure date in ISO format (YYYY-MM-DD)&quot;)],
    return_date: Annotated[str, Field(description=&quot;Return date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; FlightSuggestions:
    &quot;&quot;&quot;
    Suggest flights based on locations and dates.
    &quot;&quot;&quot;
    # Validate dates
    dep_date = validate_iso_date(departure_date, &quot;departure_date&quot;)
    ret_date = validate_iso_date(return_date, &quot;return_date&quot;)
    if ret_date &lt;= dep_date:
        raise ValueError(&quot;return_date must be after departure_date&quot;)

    # Generate mock flight data
    flights = [
        Flight(
            flight_id=str(uuid.uuid4())[:8].upper(),
            airline=random.choice([&quot;SkyWings&quot;, &quot;Global Air&quot;]),
            flight_number=f&quot;{random.choice(&#39;ABCDEFG&#39;)}{random.randint(100, 9999)}&quot;,
            from_airport=Airport(code=&quot;AAA&quot;, name=&quot;Airport A&quot;, city=from_location),
            to_airport=Airport(code=&quot;BBB&quot;, name=&quot;Airport B&quot;, city=to_location),
            departure=dep_date.isoformat(),
            arrival=(dep_date + timedelta(hours=random.randint(1, 8))).isoformat(),
            duration_minutes=random.randint(60, 480),
            is_direct=True,
            price=random.uniform(100, 500),
            currency=&quot;USD&quot;,
            available_seats=random.randint(1, 30),
            cabin_class=random.choice([&quot;Economy&quot;, &quot;Business&quot;]),
            segments=[],
            connection=None,
        )
        for _ in range(5)
    ]
    return FlightSuggestions(departure_flights=flights, return_flights=[])
</code></pre>
<ul>
<li>Generates mock flight data, including airline names, flight numbers, and durations.</li>
<li>Handles both direct and connecting flights, ensuring realistic travel scenarios.</li>
<li>Uses Python‚Äôs datetime module for precise date and time calculations.</li>
<li>Implements error handling for invalid dates and input mismatches.</li>
<li>Demonstrates scalability with asynchronous execution for concurrent requests.</li>
</ul>
<hr>
<pre><code class="language-python">def validate_iso_date(date_str: str, param_name: str) -&gt; datetime.date:
    &quot;&quot;&quot;
    Validates that a string is in ISO format (YYYY-MM-DD) and returns the parsed date.
    &quot;&quot;&quot;
    iso_pattern = re.compile(r&quot;^\d{4}-\d{2}-\d{2}{{QUEST_CONTENT}}quot;)
    if not iso_pattern.match(date_str):
        raise ValueError(f&quot;{param_name} must be in ISO format (YYYY-MM-DD), got: {date_str}&quot;)

    try:
        return datetime.strptime(date_str, &quot;%Y-%m-%d&quot;).date()
    except ValueError as e:
        raise ValueError(f&quot;Invalid {param_name}: {e}&quot;)
</code></pre>
<ul>
<li>Ensures input strings conform to ISO date format, preventing malformed data.</li>
<li>Uses regular expressions for pattern matching and validation.</li>
<li>Converts valid strings into Python <code class="inline-code">datetime</code> objects for further processing.</li>
<li>Raises descriptive errors to guide users in correcting invalid inputs.</li>
<li>Centralizes validation logic, making it reusable across multiple tools.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Notice how the <code class="inline-code">@mcp.tool</code> decorator simplifies tool registration within the MCP framework.</li>
<li>Study the use of Pydantic‚Äôs <code class="inline-code">Field</code> annotations to describe input parameters and improve clarity.</li>
<li>Explore how mock data generation can simulate real-world API responses for testing and development.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the starship‚Äôs systems.</p>
<p>Mission accomplished, star voyager! üöÄ You&#39;ve navigated the linguistic galaxies of Polyglot Stellar Services with 60% completion‚Äîkeep firing those thrusters toward the final frontier! ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>