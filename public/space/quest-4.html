<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deploying Polyglot Tools - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/Azure-Samples/azure-ai-travel-agents" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Galactic Codex: The Multi-Agent Odyssey</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Polyglot MCP Services Architecture</h1>
<hr>
<p>As the <em>Llama Voyager</em> ventures deeper into the uncharted nebulae of data, the Galactic Codex&#39;s multi-lingual capabilities are put to the test. Aboard the ship, the Triage Agent orchestrates a symphony of tools written in Python, Java, and TypeScript, ensuring seamless communication and execution across the polyglot architecture. Your mission is to investigate the inner workings of these tools, uncover their specialized functionalities, and ensure their flawless integration into the ship&#39;s MCP-powered ecosystem.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Tool Discovery Mechanism</strong>: How are tools registered and made accessible to the MCP protocol in each language?</li>
<li>‚ö° <strong>Service Coordination</strong>: What patterns are used to ensure that each tool executes its specialized functionality correctly?</li>
<li>üõ°Ô∏è <strong>Error Handling Strategy</strong>: How do the services handle invalid inputs or unexpected errors gracefully?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a>:</span> Python Itinerary Planning Tool</h3>
<p>This file implements a Python-based MCP server for suggesting hotels and flights. It uses the <code class="inline-code">FastMCP</code> library to define tools and handle requests. The <code class="inline-code">suggest_hotels</code> and <code class="inline-code">suggest_flights</code> tools provide dynamic travel recommendations based on user inputs. Validation mechanisms ensure the integrity of input data, while mock data generation simulates realistic results.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">suggest_hotels</code> dynamically generates hotel recommendations based on location and dates, ensuring input validation for ISO date formats.</li>
<li><code class="inline-code">suggest_flights</code> provides flight suggestions with realistic mock data, including direct and connecting flights, while validating departure and return dates.</li>
<li><code class="inline-code">validate_iso_date</code> ensures that date inputs conform to the ISO format, preventing invalid data from being processed.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a></h3>
<pre><code class="language-python">@mcp.tool()
async def suggest_hotels(
    location: Annotated[str, Field(description=&quot;Location (city or area) to search for hotels&quot;)],
    check_in: Annotated[str, Field(description=&quot;Check-in date in ISO format (YYYY-MM-DD)&quot;)],
    check_out: Annotated[str, Field(description=&quot;Check-out date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; HotelSuggestions:
    &quot;&quot;&quot;
    Suggest hotels based on location and dates.
    &quot;&quot;&quot;
    check_in_date = validate_iso_date(check_in, &quot;check_in&quot;)
    check_out_date = validate_iso_date(check_out, &quot;check_out&quot;)

    if check_out_date &lt;= check_in_date:
        raise ValueError(&quot;check_out date must be after check_in date&quot;)

    hotel_types = [&quot;Luxury&quot;, &quot;Boutique&quot;, &quot;Budget&quot;, &quot;Business&quot;]
    amenities = [&quot;Free WiFi&quot;, &quot;Pool&quot;, &quot;Spa&quot;, &quot;Gym&quot;, &quot;Restaurant&quot;, &quot;Bar&quot;, &quot;Room Service&quot;, &quot;Parking&quot;]

    def generate_rating():
        return round(random.uniform(3.0, 5.0), 1)

    def generate_price(hotel_type):
        price_ranges = {
            &quot;Luxury&quot;: (250, 600),
            &quot;Boutique&quot;: (180, 350),
            &quot;Budget&quot;: (80, 150),
            &quot;Resort&quot;: (200, 500),
            &quot;Business&quot;: (150, 300),
        }
        min_price, max_price = price_ranges.get(hotel_type, (100, 300))
        return round(random.uniform(min_price, max_price))

    num_hotels = random.randint(3, 8)
    hotels = []

    for i in range(num_hotels):
        hotel_type = random.choice(hotel_types)
        hotel_amenities = random.sample(amenities, random.randint(3, 6))
        hotel = Hotel(
            name=f&quot;{hotel_type} Hotel&quot;,
            address=fake.street_address(),
            location=location,
            rating=generate_rating(),
            price_per_night=generate_price(hotel_type),
            hotel_type=hotel_type,
            amenities=hotel_amenities,
            available_rooms=random.randint(1, 15),
        )
        hotels.append(hotel)

    hotels.sort(key=lambda x: x.rating, reverse=True)
    return HotelSuggestions(hotels=hotels)
</code></pre>
<ul>
<li>This code defines the <code class="inline-code">suggest_hotels</code> tool, which generates hotel recommendations based on location and dates.</li>
<li>The <code class="inline-code">validate_iso_date</code> function ensures that input dates are in the correct format, preventing invalid data from being processed.</li>
<li>Hotels are dynamically generated with randomized attributes such as type, amenities, and price.</li>
<li>The results are sorted by rating to prioritize the best options for the user.</li>
<li>This approach demonstrates effective use of mock data generation for testing and development.</li>
</ul>
<hr>
<pre><code class="language-python">@mcp.tool()
async def suggest_flights(
    from_location: Annotated[str, Field(description=&quot;Departure location (city or airport)&quot;)],
    to_location: Annotated[str, Field(description=&quot;Destination location (city or airport)&quot;)],
    departure_date: Annotated[str, Field(description=&quot;Departure date in ISO format (YYYY-MM-DD)&quot;)],
    return_date: Annotated[str, Field(description=&quot;Return date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; FlightSuggestions:
    &quot;&quot;&quot;
    Suggest flights based on locations and dates.
    &quot;&quot;&quot;
    dep_date = validate_iso_date(departure_date, &quot;departure_date&quot;)
    ret_date = validate_iso_date(return_date, &quot;return_date&quot;)
    if ret_date &lt;= dep_date:
        return &quot;Error: return_date must be after departure_date&quot;

    airlines = [&quot;SkyWings&quot;, &quot;Global Air&quot;, &quot;Atlantic Airways&quot;]
    aircraft_types = [&quot;Boeing 737&quot;, &quot;Airbus A320&quot;]

    from_code = &quot;ABC&quot;
    to_code = &quot;XYZ&quot;

    departure_flights = []
    num_dep_flights = random.randint(3, 7)

    for _ in range(num_dep_flights):
        dep_time = datetime.utcnow() + timedelta(hours=random.randint(1, 24))
        flight_minutes = random.randint(60, 480)
        arr_time = dep_time + timedelta(minutes=flight_minutes)
        flight = Flight(
            flight_id=str(uuid.uuid4())[:8].upper(),
            airline=random.choice(airlines),
            flight_number=f&quot;{random.randint(100, 999)}&quot;,
            aircraft=random.choice(aircraft_types),
            from_airport=Airport(code=from_code, name=&quot;From Airport&quot;, city=&quot;From City&quot;),
            to_airport=Airport(code=to_code, name=&quot;To Airport&quot;, city=&quot;To City&quot;),
            departure=dep_time.isoformat(),
            arrival=arr_time.isoformat(),
            duration_minutes=flight_minutes,
            is_direct=True,
            price=round(random.uniform(99, 999), 2),
            currency=&quot;USD&quot;,
            available_seats=random.randint(1, 30),
            cabin_class=&quot;Economy&quot;,
            segments=[],
            connection=None,
        )
        departure_flights.append(flight)

    return FlightSuggestions(departure_flights=departure_flights, return_flights=[])
</code></pre>
<ul>
<li>The <code class="inline-code">suggest_flights</code> tool generates flight recommendations based on departure and return locations and dates.</li>
<li>Input validation ensures that dates are in ISO format and that the return date is after the departure date.</li>
<li>Mock data simulates realistic flight details, including airlines, flight numbers, and durations.</li>
<li>The generated data highlights the importance of user-friendly and dynamic responses in travel planning systems.</li>
<li>This function demonstrates how to build robust and flexible tools for MCP-based services.</li>
</ul>
<hr>
<pre><code class="language-python">def validate_iso_date(date_str: str, param_name: str) -&gt; datetime.date:
    &quot;&quot;&quot;
    Validates that a string is in ISO format (YYYY-MM-DD) and returns the parsed date.
    &quot;&quot;&quot;
    iso_pattern = re.compile(r&quot;^\d{4}-\d{2}-\d{2}{{QUEST_CONTENT}}quot;)
    if not iso_pattern.match(date_str):
        raise ValueError(f&quot;{param_name} must be in ISO format (YYYY-MM-DD), got: {date_str}&quot;)

    try:
        return datetime.strptime(date_str, &quot;%Y-%m-%d&quot;).date()
    except ValueError as e:
        raise ValueError(f&quot;Invalid {param_name}: {e}&quot;)
</code></pre>
<ul>
<li>This utility function validates date inputs to ensure they conform to the ISO format (YYYY-MM-DD).</li>
<li>The regular expression check prevents invalid strings from being processed.</li>
<li>Parsing errors are caught and reported with descriptive error messages.</li>
<li>This function plays a critical role in ensuring data integrity for tools like <code class="inline-code">suggest_hotels</code> and <code class="inline-code">suggest_flights</code>.</li>
<li>It demonstrates the importance of input validation in building reliable services.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Investigate how the <code class="inline-code">@mcp.tool</code> decorator simplifies the definition of MCP tools and integrates them into the server.</li>
<li>Pay attention to the mock data generation techniques, which make the tools both realistic and flexible during development.</li>
<li>Validate how error messages are constructed to provide clear feedback to users when inputs are invalid.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the starship&#39;s systems.</p>
<p>Mission accomplished, star voyager! üöÄ Your successful deployment of Polyglot Tools has propelled you 60% closer to the cosmic finish line‚Äîkeep charting your stellar course to mastery! ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>