<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Polyglot MCP Services Architecture - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/Azure-Samples/azure-ai-travel-agents" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Galactic Mission: The Orchestrated Odyssey</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Polyglot MCP Services Architecture</h1>
<hr>
<p>In the uncharted expanse of the Andromeda galaxy, the <em>Llama Voyager</em> is tasked with a critical mission: to unify the diverse systems of the Multi-Language Communication Protocol (MCP). The ship‚Äôs AI must seamlessly orchestrate services written in Python, Java, and TypeScript to provide interstellar travelers with real-time destination recommendations, itinerary planning, and responsive echo services. As the crew ventures deeper into the stellar void, they must ensure the polyglot architecture remains robust, scalable, and harmonious, enabling the <em>Llama Voyager</em> to decode the mysteries of the cosmos.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Protocol Harmonization</strong>: How do the MCP servers in different languages initialize their unique tools and expose them for discovery by the <em>Llama Voyager</em>?</li>
<li>‚ö° <strong>Service Integration</strong>: How are destination recommendations, itinerary planning, and echo services implemented and connected to the MCP protocol?</li>
<li>üõ°Ô∏è <strong>Error Safeguards</strong>: What mechanisms are in place to validate inputs and handle errors in these polyglot services?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a>:</span> Python-based service for itinerary planning</h3>
<p>The Python MCP server leverages the <code class="inline-code">FastMCP</code> framework to provide tools for suggesting hotels and flights. This file defines the <code class="inline-code">suggest_hotels</code> and <code class="inline-code">suggest_flights</code> tools, which validate inputs, generate mock data, and ensure realistic responses. The server uses decorators to expose its methods as MCP tools.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">suggest_hotels</code>: Suggests hotels based on location and dates, validating ISO date formats and generating mock hotel data.</li>
<li><code class="inline-code">suggest_flights</code>: Suggests flights based on departure and return locations and dates, including direct and connecting flight options.</li>
<li><code class="inline-code">validate_iso_date</code>: Ensures date strings are in ISO format and parses them into date objects.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a></h3>
<pre><code class="language-python">@mcp.tool()
async def suggest_hotels(
    location: Annotated[str, Field(description=&quot;Location (city or area) to search for hotels&quot;)],
    check_in: Annotated[str, Field(description=&quot;Check-in date in ISO format (YYYY-MM-DD)&quot;)],
    check_out: Annotated[str, Field(description=&quot;Check-out date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; HotelSuggestions:
    check_in_date = validate_iso_date(check_in, &quot;check_in&quot;)
    check_out_date = validate_iso_date(check_out, &quot;check_out&quot;)
    if check_out_date &lt;= check_in_date:
        raise ValueError(&quot;check_out date must be after check_in date&quot;)
    ...
</code></pre>
<ul>
<li>Validates <code class="inline-code">check_in</code> and <code class="inline-code">check_out</code> dates, ensuring logical consistency.</li>
<li>Generates mock hotel data with randomized amenities, ratings, and prices.</li>
<li>Demonstrates the use of Python dataclasses for structured responses.</li>
</ul>
<hr>
<pre><code class="language-python">@mcp.tool()
async def suggest_flights(
    from_location: Annotated[str, Field(description=&quot;Departure location (city or airport)&quot;)],
    to_location: Annotated[str, Field(description=&quot;Destination location (city or airport)&quot;)],
    departure_date: Annotated[str, Field(description=&quot;Departure date in ISO format (YYYY-MM-DD)&quot;)],
    return_date: Annotated[str, Field(description=&quot;Return date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; FlightSuggestions:
    dep_date = validate_iso_date(departure_date, &quot;departure_date&quot;)
    ret_date = validate_iso_date(return_date, &quot;return_date&quot;)
    if ret_date &lt;= dep_date:
        return &quot;Error: return_date must be after departure_date&quot;
    ...
</code></pre>
<ul>
<li>Validates departure and return dates, ensuring proper sequencing.</li>
<li>Simulates flight data with direct and connecting options, including segments.</li>
<li>Utilizes Python type annotations to describe input parameters and return types.</li>
</ul>
<hr>
<pre><code class="language-python">def validate_iso_date(date_str: str, param_name: str) -&gt; datetime.date:
    iso_pattern = re.compile(r&quot;^\d{4}-\d{2}-\d{2}{{QUEST_CONTENT}}quot;)
    if not iso_pattern.match(date_str):
        raise ValueError(f&quot;{param_name} must be in ISO format (YYYY-MM-DD), got: {date_str}&quot;)
    ...
</code></pre>
<ul>
<li>Ensures date strings conform to the ISO 8601 format.</li>
<li>Raises descriptive errors for invalid input, aiding debugging and user feedback.</li>
<li>Demonstrates reusable validation logic for consistent input handling.</li>
</ul>
<hr>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java" target="_blank" rel="noopener noreferrer">src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java</a>:</span> Java-based service for destination recommendations</h3>
<p>This Java service uses Spring Boot to provide tools for recommending destinations based on activity, budget, and season. The <code class="inline-code">@Tool</code> annotation makes methods discoverable by MCP clients.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">getDestinationsByActivity</code>: Filters destinations based on activity type, ensuring valid input.</li>
<li><code class="inline-code">getDestinationsByPreferences</code>: Recommends destinations based on multiple criteria, validating and combining inputs.</li>
<li><code class="inline-code">getAllDestinations</code>: Provides a curated list of popular destinations.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java" target="_blank" rel="noopener noreferrer">src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java</a></h3>
<pre><code class="language-java">@Tool(description = &quot;Get travel destination recommendations based on preferred activity type&quot;)
public String getDestinationsByActivity(String activityType) {
    try {
        String activity = activityType.toUpperCase();
        if (!isValidActivityType(activity)) {
            return &quot;Invalid activity type. Please use one of: BEACH, ADVENTURE, CULTURAL, RELAXATION, URBAN_EXPLORATION, NATURE, WINTER_SPORTS&quot;;
        }
        return getDestinationsByPreference(activity, null, null, null);
    } catch (Exception e) {
        return &quot;Invalid activity type. Please use one of: BEACH, ADVENTURE, CULTURAL, RELAXATION, URBAN_EXPLORATION, NATURE, WINTER_SPORTS&quot;;
    }
}
</code></pre>
<ul>
<li>Validates activity type against predefined constants.</li>
<li>Returns descriptive error messages for invalid inputs.</li>
<li>Demonstrates modular design by delegating to <code class="inline-code">getDestinationsByPreference</code>.</li>
</ul>
<hr>
<pre><code class="language-java">@Tool(description = &quot;Get travel destination recommendations based on multiple criteria&quot;)
public String getDestinationsByPreferences(String activity, String budget, String season, Boolean familyFriendly) {
    try {
        if (activity != null &amp;&amp; !activity.isEmpty()) {
            String activityUpper = activity.toUpperCase();
            if (!isValidActivityType(activityUpper)) {
                return &quot;Invalid activity type. Please use one of: BEACH, ADVENTURE, CULTURAL, RELAXATION, URBAN_EXPLORATION, NATURE, WINTER_SPORTS&quot;;
            }
        }
        ...
        return getDestinationsByPreference(activity, budget, season, familyFriendly);
    } catch (Exception e) {
        return &quot;Invalid input. Please check your parameters and try again.&quot;;
    }
}
</code></pre>
<ul>
<li>Validates multiple criteria, ensuring all inputs are consistent.</li>
<li>Provides user-friendly error messages for invalid combinations.</li>
<li>Highlights the extensibility of multi-criteria filtering.</li>
</ul>
<hr>
<pre><code class="language-java">@Tool(description = &quot;Get a list of all available travel destinations&quot;)
public String getAllDestinations() {
    return &quot;Here are some popular travel destinations:\n\n&quot; +
           &quot;üìç Bali, Indonesia\n&quot; +
           &quot;‚≠êÔ∏è Beautiful beaches with vibrant culture and lush landscapes.\n&quot; +
           &quot;üè∑Ô∏è Activity: BEACH | Budget: MODERATE | Best Season: SUMMER | Family Friendly: Yes\n\n&quot; +
           &quot;üìç Cancun, Mexico\n&quot; +
           &quot;‚≠êÔ∏è White sandy beaches with crystal clear waters and vibrant nightlife.\n&quot; +
           &quot;üè∑Ô∏è Activity: BEACH | Budget: MODERATE | Best Season: WINTER | Family Friendly: Yes\n\n&quot; +
           &quot;üìç Maldives, Maldives\n&quot; +
           &quot;‚≠êÔ∏è Luxurious overwater bungalows and pristine beaches perfect for relaxation.\n&quot; +
           &quot;üè∑Ô∏è Activity: BEACH | Budget: LUXURY | Best Season: ALL_YEAR | Family Friendly: Yes&quot;;
}
</code></pre>
<ul>
<li>Returns a hardcoded list of curated destinations with metadata.</li>
<li>Demonstrates a fallback mechanism for general queries.</li>
<li>Provides a user-friendly interface for quick responses.</li>
</ul>
<hr>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts" target="_blank" rel="noopener noreferrer">src/tools/echo-ping/src/server.ts</a>:</span> TypeScript-based echo service</h3>
<p>This TypeScript server uses the MCP SDK to implement a simple echo tool. It highlights the integration of MCP protocols in a lightweight service.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupServerRequestHandlers</code>: Configures handlers for listing and calling tools.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts#L37" target="_blank" rel="noopener noreferrer"><code class="inline-code">handlePostRequest</code></a>: Processes MCP requests and handles errors gracefully.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts#L137" target="_blank" rel="noopener noreferrer"><code class="inline-code">createRPCErrorResponse</code></a>: Generates error responses in JSON-RPC format.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts" target="_blank" rel="noopener noreferrer">src/tools/echo-ping/src/server.ts</a></h3>
<pre><code class="language-typescript">private setupServerRequestHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async (_request) =&gt; {
        return {
            jsonrpc: JSON_RPC,
            tools: EchoTools,
        };
    });
    this.server.setRequestHandler(
        CallToolRequestSchema,
        async (request, _extra) =&gt; {
            const args = request.params.arguments;
            const toolName = request.params.name;
            const tool = EchoTools.find((tool) =&gt; tool.name === toolName);
            ...
        }
    );
}
</code></pre>
<ul>
<li>Configures MCP tool discovery and invocation.</li>
<li>Demonstrates the use of schemas for validating requests.</li>
<li>Highlights extensibility for adding new tools.</li>
</ul>
<hr>
<pre><code class="language-typescript">async handlePostRequest(req: Request, res: Response) {
    console.log(`POST ${req.originalUrl} (${req.ip}) - payload:`, req.body);
    try {
        const transport = new StreamableHTTPServerTransport({
            sessionIdGenerator: undefined,
        });
        await this.server.connect(transport);
        await transport.handleRequest(req, res, req.body);
        ...
    } catch (error) {
        console.error(&#39;Error handling MCP request:&#39;, error);
        if (!res.headersSent) {
            res.status(500).json(this.createRPCErrorResponse(&#39;Internal server error.&#39;));
        }
    }
}
</code></pre>
<ul>
<li>Handles MCP POST requests with detailed logging.</li>
<li>Manages server transport for streaming responses.</li>
<li>Implements robust error handling for failed requests.</li>
</ul>
<hr>
<pre><code class="language-typescript">private createRPCErrorResponse(message: string): JSONRPCError {
    return {
        jsonrpc: JSON_RPC,
        error: {
            code: JSON_RPC_ERROR,
            message: message,
        },
        id: randomUUID(),
    };
}
</code></pre>
<ul>
<li>Generates JSON-RPC-compliant error responses.</li>
<li>Provides unique identifiers for error tracking.</li>
<li>Encapsulates reusable error handling logic.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üõ∞Ô∏è <strong>Cross-Language Insights</strong>: Compare how Python, Java, and TypeScript implement MCP tools to understand language-specific patterns.</li>
<li>üåå <strong>Tool Validation</strong>: Pay attention to input validation mechanisms across services to ensure robust error handling.</li>
<li>üöÄ <strong>Extensibility</strong>: Consider how new tools or services could be added to this polyglot architecture.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Mission accomplished, star voyager! Quest 4: Polyglot MCP Services Architecture has been mastered, propelling your cosmic skills to 60% completion‚Äîstellar work as you chart your course toward the final frontier! üöÄ‚≠êüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>