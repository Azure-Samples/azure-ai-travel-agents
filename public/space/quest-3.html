<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Protocols of the Galactic Alliance - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/Azure-Samples/azure-ai-travel-agents" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Galactic Alliance: The AI Voyager Initiative</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Protocols of the Galactic Alliance</h1>
<hr>
<p>The AI Voyager Initiative faces a critical moment in its exploration of the galaxy. As the starship ventures deeper into uncharted sectors, the crew must master the Protocols of the Galactic Alliance, a system that enables seamless communication between specialized AI agents. These protocols, powered by the Model Context Protocol (MCP), are the key to unlocking dynamic tool discovery and multi-agent collaboration. With the LlamaIndex system orchestrating workflows, the crew must ensure that every agent and tool operates in perfect harmony to decode the mysteries of the cosmos. Will you rise to the challenge and ensure the success of this stellar mission?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Tool Discovery Protocols</strong>: How does the <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L31" target="_blank" rel="noopener noreferrer"><code class="inline-code">mcpToolsList</code></a> function dynamically retrieve and manage tools from multiple MCP servers, and what patterns ensure reliability in this process?</li>
<li>‚ö° <strong>Communication Channels</strong>: What differences exist between the <code class="inline-code">MCPClient</code> implementations for HTTP and SSE, and how do these variations impact the orchestration of agent workflows?</li>
<li>üõ°Ô∏è <strong>Error Handling in Connections</strong>: How are connection failures and unreachable MCP servers handled in the <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L39" target="_blank" rel="noopener noreferrer"><code class="inline-code">connect</code></a> methods of the clients, and what safeguards ensure system stability?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-http-client.ts" target="_blank" rel="noopener noreferrer">src/api/src/mcp/mcp-http-client.ts</a>:</span> HTTP Protocol Implementation</h3>
<p>This file defines the <code class="inline-code">MCPClient</code> class for connecting to MCP servers using the HTTP protocol. It implements dynamic tool discovery, tool invocation, and graceful connection handling. The HTTP-based transport ensures robust and streamable communication, making it suitable for modern workflows.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L39" target="_blank" rel="noopener noreferrer"><code class="inline-code">connect</code></a>: Establishes a connection to the MCP server using the HTTP transport and logs the connection status.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L57" target="_blank" rel="noopener noreferrer"><code class="inline-code">listTools</code></a>: Retrieves the list of available tools from the MCP server, enabling dynamic tool discovery.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L68" target="_blank" rel="noopener noreferrer"><code class="inline-code">callTool</code></a>: Invokes a specific tool on the MCP server with the provided arguments, showcasing the modular design of tool execution.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-http-client.ts" target="_blank" rel="noopener noreferrer">src/api/src/mcp/mcp-http-client.ts</a></h3>
<pre><code class="language-typescript">async connect() {
    await this.client.connect(this.transport);
    console.log(&#39;Connected to server&#39;);
}
</code></pre>
<ul>
<li>Establishes a connection to the MCP server using the HTTP transport.</li>
<li>Ensures the connection is active before proceeding with tool discovery or execution.</li>
<li>Logs the connection status to aid debugging and monitoring.</li>
</ul>
<pre><code class="language-typescript">async listTools() {
    const result = await this.client.listTools();
    return result.tools;
}
</code></pre>
<ul>
<li>Queries the MCP server for a list of available tools.</li>
<li>Dynamically adapts to the server&#39;s toolset, enabling flexible workflows.</li>
<li>Returns the tools for use in other parts of the system.</li>
</ul>
<pre><code class="language-typescript">async callTool(name: string, toolArgs: string) {
    console.log(`Calling tool ${name} with arguments:`, toolArgs);

    return await this.client.callTool({
      name,
      arguments: JSON.parse(toolArgs),
    });
}
</code></pre>
<ul>
<li>Invokes a specific tool on the server with serialized arguments.</li>
<li>Demonstrates modular execution of server-side tools.</li>
<li>Logs the invocation process for transparency.</li>
</ul>
<hr>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts" target="_blank" rel="noopener noreferrer">src/api/src/mcp/mcp-sse-client.ts</a>:</span> SSE Protocol Implementation</h3>
<p>This file provides an alternative <code class="inline-code">MCPClient</code> implementation using Server-Sent Events (SSE). While marked as a legacy option, it highlights key differences in transport mechanisms and their impact on tool orchestration.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L39" target="_blank" rel="noopener noreferrer"><code class="inline-code">connect</code></a>: Establishes a connection to the MCP server using SSE and traces the connection process for monitoring.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L57" target="_blank" rel="noopener noreferrer"><code class="inline-code">listTools</code></a>: Retrieves tools via SSE transport, demonstrating legacy compatibility with dynamic discovery.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L68" target="_blank" rel="noopener noreferrer"><code class="inline-code">callTool</code></a>: Executes server-side tools while leveraging SSE for communication.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts" target="_blank" rel="noopener noreferrer">src/api/src/mcp/mcp-sse-client.ts</a></h3>
<pre><code class="language-typescript">connect() {
    return tracer.startActiveSpan(&quot;connect&quot;, async (span) =&gt; {
      log(&quot;Connecting to MCP SSE server&quot;);
      try {
        await this.client.connect(this.transport);
        log(&quot;Connected to MCP SSE server&quot;);
        span.end();
        return this.client;
      } catch (error: any) {
        log(&quot;Error connecting to MCP SSE server:&quot;, error);
        span.setStatus({ code: 2, message: (error as Error).message });
        span.end();
        throw new Error(
          `Failed to connect to MCP SSE server: ${(error as Error).message}`
        );
      }
    });
}
</code></pre>
<ul>
<li>Establishes an SSE connection to the MCP server, with tracing for detailed monitoring.</li>
<li>Handles connection errors gracefully, ensuring the system remains stable.</li>
<li>Logs the connection process for debugging and operational insights.</li>
</ul>
<pre><code class="language-typescript">async listTools() {
    return tracer.startActiveSpan(&quot;listTools&quot;, async (span) =&gt; {
      log(&quot;Tools&quot;, this.tools);
      const toolsResult = await this.client.listTools();
      this.tools = toolsResult.tools;
      log(&quot;Tools: &quot;, toolsResult);
      span.end();
      return toolsResult;
    });
}
</code></pre>
<ul>
<li>Retrieves a list of tools via SSE, maintaining compatibility with legacy systems.</li>
<li>Uses tracing to monitor and log the tool discovery process.</li>
<li>Updates the internal toolset for subsequent operations.</li>
</ul>
<pre><code class="language-typescript">async callTool(toolName: string, args: Record&lt;string, any&gt;) {
    console.log(`Called ${toolName} with params:`, args);
    return tracer.startActiveSpan(&quot;processQuery&quot;, async (span) =&gt; {
      log(&quot;Tools&quot;, this.tools);

      const toolResult = await this.client.callTool({
        name: toolName,
        arguments: args,
      });

      log(&quot;Tool result&quot;, toolResult);
      span.end();
      return toolResult;
    });
}
</code></pre>
<ul>
<li>Executes tools on the server using SSE for communication.</li>
<li>Logs and traces the execution process for transparency and debugging.</li>
<li>Demonstrates compatibility with the legacy SSE transport.</li>
</ul>
<hr>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts" target="_blank" rel="noopener noreferrer">src/api/src/mcp/mcp-tools.ts</a>:</span> Tool Discovery and Initialization</h3>
<p>This file orchestrates tool discovery across multiple MCP servers, leveraging both HTTP and SSE clients. It encapsulates the dynamic initialization of clients and the retrieval of toolsets.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L19" target="_blank" rel="noopener noreferrer"><code class="inline-code">client</code></a>: Dynamically initializes an MCP client based on the server&#39;s configuration, supporting both HTTP and SSE transports.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L31" target="_blank" rel="noopener noreferrer"><code class="inline-code">mcpToolsList</code></a>: Iterates through server configurations to retrieve toolsets, handling errors and unreachable servers gracefully.</li>
<li><code class="inline-code">McpServerDefinition</code>: Defines the structure for MCP server configurations, ensuring compatibility with the discovery process.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts" target="_blank" rel="noopener noreferrer">src/api/src/mcp/mcp-tools.ts</a></h3>
<pre><code class="language-typescript">function client(config: LlamaIndexMCPClientOptions): MCPSSEClient | MCPHTTPClient {
  console.log(`Initializing MCP client`);
  console.log(`Using configuration:`, {config});

  if (config.type === &quot;sse&quot;) {
    // legacy implementation using SSE
    return new MCPSSEClient(&quot;llamaindex-sse-client&quot;, config.url, config.accessToken);
  } else {
    return new MCPHTTPClient(&quot;llamaindex-http-client&quot;, config.url, config.accessToken);
  }
}
</code></pre>
<ul>
<li>Dynamically initializes an MCP client based on the configuration.</li>
<li>Supports both HTTP and SSE transports, ensuring flexibility and compatibility.</li>
<li>Logs the initialization process for transparency.</li>
</ul>
<pre><code class="language-typescript">export async function mcpToolsList(config: McpServerDefinition[]) {
  return await Promise.all(
    config.map(async ({ id, name, config }) =&gt; {
      const { url, type } = config;
      const mcpClient = client(config);
      
      try {
        console.log(`Connecting to MCP server ${name} at ${url}`);
        await mcpClient.connect();
        console.log(`MCP server ${name} is reachable`);
        const tools = await mcpClient.listTools();

        console.log(`MCP server ${name} has ${tools.length} tools`);
        return {
          id,
          name,
          url,
          type,
          reachable: true,
          selected: id !== &quot;echo-ping&quot;,
          tools,
        };
      } catch (error: unknown) {
        console.error(
          `MCP server ${name} is not reachable`,
          (error as Error).message
        );
        return {
          id,
          name,
          url,
          type,
          reachable: false,
          selected: false,
          tools: [],
          error: (error as Error).message,
        };
      }
    })
  );
}
</code></pre>
<ul>
<li>Iterates through MCP server configurations to retrieve toolsets dynamically.</li>
<li>Handles connection errors gracefully, ensuring system stability.</li>
<li>Logs the discovery process for debugging and operational insights.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use the <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L39" target="_blank" rel="noopener noreferrer"><code class="inline-code">connect</code></a> methods to understand how the system establishes communication with MCP servers.</li>
<li>Compare the HTTP and SSE implementations to identify the advantages and trade-offs of each protocol.</li>
<li>Study the <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L31" target="_blank" rel="noopener noreferrer"><code class="inline-code">mcpToolsList</code></a> function to see how dynamic tool discovery is orchestrated across multiple servers.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the AI Voyager Initiative.</p>
<p>Mission accomplished, Star Voyager! You&#39;ve navigated the cosmic protocols of the Galactic Alliance with precision‚Äî40% of your interstellar quest complete and the stars themselves cheering you onward to infinity! üöÄ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>