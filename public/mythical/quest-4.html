<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Polyglot Tower of Services - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/Azure-Samples/azure-ai-travel-agents" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Kingdom of Azure Agents</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Polyglot Tower of Services</h1>
<hr>
<p>In the Kingdom of Azure Agents, a grand Polyglot Tower stands tall, its many floors humming with the magic of diverse languages and enchanted services. Each floor is dedicated to a unique tongue‚ÄîPython, Java, TypeScript, and more‚Äîwhere mystical tools work in harmony under the guidance of the Crystal of Orchestration. Brave adventurer, ascend this tower to uncover the secrets of how these multilingual agents collaborate to deliver seamless travel plans. The MCP Protocol binds their spells, enabling dynamic discovery and execution of their powers.</p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:</p>
<ul>
<li>üéØ <strong>MCP Protocol</strong>: How the Model Context Protocol enables dynamic discovery and invocation of tools across services.</li>
<li>üîç <strong>Polyglot Architecture</strong>: How multiple languages (Python, Java, TypeScript) coexist and communicate in a unified system.</li>
<li>‚ö° <strong>Service Registration</strong>: How services are registered and exposed dynamically to orchestrators like LlamaIndex.</li>
<li>üí° <strong>Tool Design</strong>: How tools are implemented with annotations and modular patterns for extensibility.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/tools/itinerary-planning/src/mcp_server.py</code></a></h3>
<p>This Python-based MCP server powers the Itinerary Planning Agent, offering tools to suggest hotels and flights based on user preferences. The <code class="inline-code">FastMCP</code> library orchestrates the server, while data validation ensures robust input handling. The tools leverage mock data generation to simulate real-world responses, making the service both functional and extensible.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">suggest_hotels</code>: Suggests hotels based on location, check-in, and check-out dates, validating inputs for consistency.</li>
<li><code class="inline-code">suggest_flights</code>: Provides flight options, including direct and connecting flights, with realistic mock data.</li>
<li><code class="inline-code">validate_iso_date</code>: Ensures date inputs are in ISO format and valid, preventing errors in tool execution.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-python">@mcp.tool()
async def suggest_hotels(
    location: Annotated[str, Field(description=&quot;Location (city or area) to search for hotels&quot;)],
    check_in: Annotated[str, Field(description=&quot;Check-in date in ISO format (YYYY-MM-DD)&quot;)],
    check_out: Annotated[str, Field(description=&quot;Check-out date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; HotelSuggestions:
    check_in_date = validate_iso_date(check_in, &quot;check_in&quot;)
    check_out_date = validate_iso_date(check_out, &quot;check_out&quot;)
    if check_out_date &lt;= check_in_date:
        raise ValueError(&quot;check_out date must be after check_in date&quot;)
    # Generate mock hotels
    hotels = [
        Hotel(
            name=f&quot;Luxury Hotel {i}&quot;,
            address=fake.street_address(),
            location=f&quot;{location}, Downtown&quot;,
            rating=random.uniform(3.0, 5.0),
            price_per_night=random.randint(100, 500),
            hotel_type=&quot;Luxury&quot;,
            amenities=[&quot;Free WiFi&quot;, &quot;Pool&quot;],
            available_rooms=random.randint(1, 10),
        ) for i in range(5)
    ]
    return HotelSuggestions(hotels=hotels)
</code></pre>
<ul>
<li>Validates ISO date strings and ensures logical consistency between check-in and check-out dates.</li>
<li>Generates mock hotel data with realistic attributes like price, ratings, and amenities.</li>
<li>Demonstrates the use of Python&#39;s <code class="inline-code">dataclass</code> for structured data representation.</li>
</ul>
<hr>
<pre><code class="language-python">@mcp.tool()
async def suggest_flights(
    from_location: Annotated[str, Field(description=&quot;Departure location (city or airport)&quot;)],
    to_location: Annotated[str, Field(description=&quot;Destination location (city or airport)&quot;)],
    departure_date: Annotated[str, Field(description=&quot;Departure date in ISO format (YYYY-MM-DD)&quot;)],
    return_date: Annotated[str, Field(description=&quot;Return date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; FlightSuggestions:
    dep_date = validate_iso_date(departure_date, &quot;departure_date&quot;)
    ret_date = validate_iso_date(return_date, &quot;return_date&quot;)
    if ret_date &lt;= dep_date:
        raise ValueError(&quot;Return date must be after departure date&quot;)
    # Generate mock flights
    departure_flights = [
        Flight(
            flight_id=str(uuid.uuid4()),
            airline=&quot;SkyWings&quot;,
            from_airport=Airport(code=&quot;JFK&quot;, name=&quot;JFK Airport&quot;, city=&quot;New York&quot;),
            to_airport=Airport(code=&quot;LAX&quot;, name=&quot;LAX Airport&quot;, city=&quot;Los Angeles&quot;),
            departure=dep_date.isoformat(),
            arrival=(dep_date + timedelta(hours=6)).isoformat(),
            price=random.randint(200, 500),
        ) for _ in range(3)
    ]
    return FlightSuggestions(departure_flights=departure_flights, return_flights=[])
</code></pre>
<ul>
<li>Validates dates and ensures return flights occur after departure flights.</li>
<li>Generates realistic flight data, including airline, airports, and pricing.</li>
<li>Illustrates the use of Python&#39;s <code class="inline-code">dataclass</code> for complex nested data structures.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java</code></a></h3>
<p>This Java service recommends travel destinations based on user preferences. Using Spring Boot and MCP annotations, it exposes tools for querying destinations by activity, budget, season, or a combination of criteria.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">getDestinationsByPreferences</code>: Handles multi-criteria filtering of destinations.</li>
<li><code class="inline-code">getDestinationsByActivity</code>: Filters destinations based on activity type, ensuring valid inputs.</li>
<li><code class="inline-code">getAllDestinations</code>: Provides a default list of popular destinations.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-java">@Tool(description = &quot;Get travel destination recommendations based on multiple criteria&quot;)
public String getDestinationsByPreferences(String activity, String budget, String season, Boolean familyFriendly) {
    if (activity != null &amp;&amp; !isValidActivityType(activity.toUpperCase())) {
        return &quot;Invalid activity type.&quot;;
    }
    // Filter logic
    return &quot;Recommended destinations based on preferences.&quot;;
}
</code></pre>
<ul>
<li>Validates activity types using helper functions to ensure input consistency.</li>
<li>Demonstrates the use of annotations for tool registration in Spring Boot.</li>
<li>Implements modular filtering logic for extensibility.</li>
</ul>
<hr>
<pre><code class="language-java">@Tool(description = &quot;Get a list of all available travel destinations&quot;)
public String getAllDestinations() {
    return &quot;üìç Bali, Indonesia\nüìç Kyoto, Japan\nüìç New York City, USA&quot;;
}
</code></pre>
<ul>
<li>Provides a simple, hardcoded list of popular destinations for fallback scenarios.</li>
<li>Highlights the importance of default options in service design.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/tools/echo-ping/src/server.ts</code></a></h3>
<p>This TypeScript service acts as a lightweight MCP server, primarily for testing and echoing requests. It demonstrates the setup of MCP tools and the handling of HTTP requests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupServerRequestHandlers</code>: Registers tools dynamically with the MCP server.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts#L37" target="_blank" rel="noopener noreferrer"><code class="inline-code">handlePostRequest</code></a>: Handles incoming MCP requests and invokes the appropriate tools.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts#L137" target="_blank" rel="noopener noreferrer"><code class="inline-code">createRPCErrorResponse</code></a>: Generates standardized error responses for MCP requests.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">private setupServerRequestHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; ({
    tools: EchoTools,
  }));
  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    const tool = EchoTools.find((t) =&gt; t.name === request.params.name);
    if (!tool) {
      return this.createRPCErrorResponse(`Tool ${request.params.name} not found.`);
    }
    return await tool.execute(request.params.arguments);
  });
}
</code></pre>
<ul>
<li>Registers tools dynamically, enabling extensibility without modifying core logic.</li>
<li>Validates tool existence before execution, ensuring robust error handling.</li>
<li>Demonstrates the use of schemas for request validation.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use the <code class="inline-code">@Tool</code> annotation in Java services to expose methods as MCP tools.</li>
<li>Explore how Python&#39;s <code class="inline-code">FastMCP</code> simplifies server creation and tool registration.</li>
<li>Study the TypeScript <code class="inline-code">setupServerRequestHandlers</code> method to understand dynamic tool registration.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:</p>
<ol>
<li><strong>Extend Destination Service</strong>: Add a new method in <code class="inline-code">DestinationService</code> to recommend destinations based on weather preferences. Register it using the <code class="inline-code">@Tool</code> annotation and test it via the MCP protocol.</li>
<li><strong>Trace MCP Flow</strong>: Add logging to the <code class="inline-code">setupServerRequestHandlers</code> method in <code class="inline-code">server.ts</code> to trace the flow of requests and responses. Observe how the MCP server processes incoming requests.</li>
</ol>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the Kingdom&#39;s enchanted systems.</p>
<p>Behold, valiant seeker, for you have ascended another tier of the Polyglot Tower of Services, weaving the tongues of realms into your arsenal‚Äîforge onward, champion, for the stars themselves herald your triumph! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>