<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Polyglot MCP Services Architecture - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-developer">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/Azure-Samples/azure-ai-travel-agents" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Multi-Agent Orchestration with Azure AI Travel Agents</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Polyglot MCP Services Architecture</h1>
<hr>
<p>The Azure AI Travel Agents application demonstrates the power of polyglot architectures by integrating MCP services written in Python, Java, and TypeScript. Each service is a self-contained module, designed to handle specific tasks such as itinerary planning, destination recommendations, and echo testing. These services are orchestrated through the Model Context Protocol (MCP), enabling seamless communication and tool discovery across diverse programming languages. This quest delves into the inner workings of these services to uncover how they collaborate to enhance travel planning.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Service Interoperability</strong>: How do the MCP services written in different languages communicate and expose their functionality?</li>
<li>‚ö° <strong>Dynamic Tool Discovery</strong>: How are tools dynamically registered and made discoverable in each service?</li>
<li>üõ°Ô∏è <strong>Error Handling Patterns</strong>: What mechanisms are in place to validate inputs and handle errors gracefully in these services?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a>:</span> Python-based itinerary planning service</h3>
<p>This file implements the MCP server for itinerary planning, providing tools to suggest hotels and flights. The service uses <code class="inline-code">FastMCP</code> to define tools and handle requests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">suggest_hotels(...)</code>: Suggests hotels based on location, check-in, and check-out dates while validating inputs.</li>
<li><code class="inline-code">suggest_flights(...)</code>: Generates realistic mock flight data, including direct and connecting flights, based on departure and return locations and dates.</li>
<li><code class="inline-code">validate_iso_date(...)</code>: Validates date strings to ensure they follow the ISO format and checks for logical inconsistencies.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a></h3>
<pre><code class="language-python">@mcp.tool()
async def suggest_hotels(
    location: Annotated[str, Field(description=&quot;Location (city or area) to search for hotels&quot;)],
    check_in: Annotated[str, Field(description=&quot;Check-in date in ISO format (YYYY-MM-DD)&quot;)],
    check_out: Annotated[str, Field(description=&quot;Check-out date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; HotelSuggestions:
    &quot;&quot;&quot;
    Suggest hotels based on location and dates.
    &quot;&quot;&quot;
    # Validate dates
    check_in_date = validate_iso_date(check_in, &quot;check_in&quot;)
    check_out_date = validate_iso_date(check_out, &quot;check_out&quot;)

    # Ensure check_out is after check_in
    if check_out_date &lt;= check_in_date:
        raise ValueError(&quot;check_out date must be after check_in date&quot;)

    # Generate hotel suggestions
    ...
</code></pre>
<ul>
<li><strong>What this code does</strong>: Defines a tool to suggest hotels based on user preferences, including location and date range.</li>
<li><strong>Key patterns</strong>: Uses <code class="inline-code">@mcp.tool()</code> to register the function as an MCP tool.</li>
<li><strong>Why this approach</strong>: Validates inputs to ensure logical consistency and generates realistic mock data.</li>
<li><strong>Connections</strong>: Relies on <code class="inline-code">validate_iso_date</code> for input validation.</li>
<li><strong>Details to notice</strong>: Emphasizes error handling and user-friendly feedback.</li>
</ul>
<hr>
<pre><code class="language-python">@mcp.tool()
async def suggest_flights(
    from_location: Annotated[str, Field(description=&quot;Departure location (city or airport)&quot;)],
    to_location: Annotated[str, Field(description=&quot;Destination location (city or airport)&quot;)],
    departure_date: Annotated[str, Field(description=&quot;Departure date in ISO format (YYYY-MM-DD)&quot;)],
    return_date: Annotated[str, Field(description=&quot;Return date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; FlightSuggestions:
    &quot;&quot;&quot;
    Suggest flights based on locations and dates.
    &quot;&quot;&quot;
    # Validate dates
    dep_date = validate_iso_date(departure_date, &quot;departure_date&quot;)
    ret_date = validate_iso_date(return_date, &quot;return_date&quot;)
    if ret_date &lt;= dep_date:
        raise ValueError(&quot;return_date must be after departure_date&quot;)

    # Generate flight suggestions
    ...
</code></pre>
<ul>
<li><strong>Core functionality</strong>: Suggests flights based on user input, including direct and connecting flights.</li>
<li><strong>Implementation details</strong>: Uses structured data models to represent flights and segments.</li>
<li><strong>Design decisions</strong>: Ensures return date is after departure date to avoid logical errors.</li>
<li><strong>Relationships</strong>: Shares validation logic with <code class="inline-code">suggest_hotels</code>.</li>
<li><strong>Concepts illustrated</strong>: Dynamic data generation and input validation.</li>
</ul>
<hr>
<pre><code class="language-python">def validate_iso_date(date_str: str, param_name: str) -&gt; datetime.date:
    &quot;&quot;&quot;
    Validates that a string is in ISO format (YYYY-MM-DD) and returns the parsed date.
    &quot;&quot;&quot;
    iso_pattern = re.compile(r&quot;^\d{4}-\d{2}-\d{2}{{QUEST_CONTENT}}quot;)
    if not iso_pattern.match(date_str):
        raise ValueError(f&quot;{param_name} must be in ISO format (YYYY-MM-DD), got: {date_str}&quot;)
    return datetime.strptime(date_str, &quot;%Y-%m-%d&quot;).date()
</code></pre>
<ul>
<li><strong>Role in the system</strong>: Ensures date inputs are valid and correctly formatted.</li>
<li><strong>Techniques demonstrated</strong>: Regular expression matching and exception handling.</li>
<li><strong>Error handling</strong>: Provides meaningful feedback for invalid inputs.</li>
<li><strong>Performance considerations</strong>: Lightweight validation logic.</li>
<li><strong>Learning opportunities</strong>: Importance of input validation in service APIs.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Practical tip</strong>: Use the <code class="inline-code">@mcp.tool()</code> decorator to easily register functions as tools in MCP services.</li>
<li><strong>Exploration recommendation</strong>: Study how <code class="inline-code">FastMCP</code> simplifies tool registration and request handling.</li>
<li><strong>Next steps</strong>: Investigate how other services (e.g., Java-based destination recommendations) implement similar patterns.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Congratulations on refactoring your skill stack and deploying a robust understanding of Polyglot MCP Services Architecture‚Äîyou&#39;re now 60% compiled towards Quest completion! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>