<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polyglot MCP Service Implementation - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-developer">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/Azure-Samples/azure-ai-travel-agents" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Multi-Agent Orchestration with LlamaIndex and MCP</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Polyglot MCP Services Architecture</h1>
<hr>
<p>In this quest, you will explore the polyglot architecture of the Azure AI Travel Agents project, where MCP (Model Context Protocol) services are implemented across Python, Java, and TypeScript. These services enable dynamic tool discovery and provide specialized functionalities such as itinerary planning, travel destination recommendations, and echo testing. By understanding the implementation of these services, you will uncover how the system achieves seamless interoperability between diverse technologies.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Tool Design</strong>: How are tools structured and annotated to expose their functionalities in each language?</li>
<li>‚ö° <strong>Initialization Patterns</strong>: What are the key initialization steps for MCP servers in Python, Java, and TypeScript, and how do they differ?</li>
<li>üõ°Ô∏è <strong>Error Handling</strong>: How do these services validate inputs and handle invalid or unexpected requests?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a>:</span> Python MCP Server for Itinerary Planning</h3>
<p>This file implements the MCP server for itinerary planning in Python using the FastMCP library. It provides tools for suggesting hotels and flights based on user inputs. The server demonstrates robust input validation, dynamic data generation, and asynchronous patterns.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">suggest_hotels</code>: Suggests hotels based on location and dates, with input validation and dynamic mock data generation.</li>
<li><code class="inline-code">suggest_flights</code>: Suggests flights based on departure and return locations, with support for direct and connecting flights.</li>
<li><code class="inline-code">validate_iso_date</code>: Validates ISO date strings and ensures proper date formatting.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a></h3>
<pre><code class="language-python">@mcp.tool()
async def suggest_hotels(
    location: Annotated[str, Field(description=&quot;Location (city or area) to search for hotels&quot;)],
    check_in: Annotated[str, Field(description=&quot;Check-in date in ISO format (YYYY-MM-DD)&quot;)],
    check_out: Annotated[str, Field(description=&quot;Check-out date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; HotelSuggestions:
    &quot;&quot;&quot;
    Suggest hotels based on location and dates.
    &quot;&quot;&quot;
    # Validate dates
    check_in_date = validate_iso_date(check_in, &quot;check_in&quot;)
    check_out_date = validate_iso_date(check_out, &quot;check_out&quot;)

    # Ensure check_out is after check_in
    if check_out_date &lt;= check_in_date:
        raise ValueError(&quot;check_out date must be after check_in date&quot;)

    # Generate mock data for hotels
    hotel_types = [&quot;Luxury&quot;, &quot;Boutique&quot;, &quot;Budget&quot;, &quot;Business&quot;]
    amenities = [&quot;Free WiFi&quot;, &quot;Pool&quot;, &quot;Spa&quot;, &quot;Gym&quot;, &quot;Restaurant&quot;, &quot;Bar&quot;, &quot;Room Service&quot;, &quot;Parking&quot;]
    hotels = [
        Hotel(
            name=f&quot;{random.choice(hotel_types)} Hotel&quot;,
            address=fake.street_address(),
            location=f&quot;{location}&quot;,
            rating=round(random.uniform(3.0, 5.0), 1),
            price_per_night=random.randint(100, 500),
            hotel_type=random.choice(hotel_types),
            amenities=random.sample(amenities, random.randint(3, 6)),
            available_rooms=random.randint(1, 20),
        )
        for _ in range(random.randint(3, 8))
    ]
    return HotelSuggestions(hotels=hotels)
</code></pre>
<ul>
<li>Validates input dates using <code class="inline-code">validate_iso_date</code> to ensure correct formatting and logical consistency.</li>
<li>Generates dynamic mock data for hotels, including ratings, prices, and amenities.</li>
<li>Demonstrates the use of <code class="inline-code">@mcp.tool()</code> to expose the function as an MCP tool.</li>
</ul>
<hr>
<pre><code class="language-python">@mcp.tool()
async def suggest_flights(
    from_location: Annotated[str, Field(description=&quot;Departure location (city or airport)&quot;)],
    to_location: Annotated[str, Field(description=&quot;Destination location (city or airport)&quot;)],
    departure_date: Annotated[str, Field(description=&quot;Departure date in ISO format (YYYY-MM-DD)&quot;)],
    return_date: Annotated[str, Field(description=&quot;Return date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; FlightSuggestions:
    &quot;&quot;&quot;
    Suggest flights based on locations and dates.
    &quot;&quot;&quot;
    # Validate dates
    dep_date = validate_iso_date(departure_date, &quot;departure_date&quot;)
    ret_date = validate_iso_date(return_date, &quot;return_date&quot;)

    # Ensure return date is after departure date
    if ret_date &lt;= dep_date:
        raise ValueError(&quot;Return date must be after departure date.&quot;)

    # Generate mock flight data
    airlines = [&quot;SkyWings&quot;, &quot;Global Air&quot;, &quot;Atlantic Airways&quot;]
    flights = [
        Flight(
            flight_id=str(uuid.uuid4()),
            airline=random.choice(airlines),
            departure=dep_date.isoformat(),
            arrival=(dep_date + timedelta(hours=random.randint(1, 10))).isoformat(),
            price=random.randint(100, 1000),
        )
        for _ in range(5)
    ]
    return FlightSuggestions(departure_flights=flights, return_flights=flights)
</code></pre>
<ul>
<li>Ensures departure and return dates are valid and logically consistent.</li>
<li>Generates mock flight data dynamically, including airlines, prices, and flight durations.</li>
<li>Uses <code class="inline-code">@mcp.tool()</code> to expose the function as an MCP tool for integration.</li>
</ul>
<hr>
<pre><code class="language-python">def validate_iso_date(date_str: str, param_name: str) -&gt; datetime.date:
    &quot;&quot;&quot;
    Validates that a string is in ISO format (YYYY-MM-DD) and returns the parsed date.
    &quot;&quot;&quot;
    iso_pattern = re.compile(r&quot;^\d{4}-\d{2}-\d{2}{{QUEST_CONTENT}}quot;)
    if not iso_pattern.match(date_str):
        raise ValueError(f&quot;{param_name} must be in ISO format (YYYY-MM-DD), got: {date_str}&quot;)
    return datetime.strptime(date_str, &quot;%Y-%m-%d&quot;).date()
</code></pre>
<ul>
<li>Validates ISO date strings to ensure correct format and raises descriptive errors for invalid inputs.</li>
<li>Demonstrates defensive programming to prevent invalid data from propagating through the system.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Pay attention to how <code class="inline-code">@mcp.tool()</code> annotations are used to expose Python functions as MCP tools.</li>
<li>Study the input validation patterns to ensure robust error handling in your own implementations.</li>
<li>Explore how mock data generation is used to simulate real-world scenarios for testing and demonstration purposes.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the Azure AI Travel Agents project.</p>
<p>Congratulations on achieving a major milestone in your development journey‚Äîyour Polyglot MCP Service Implementation is now feature-complete, showcasing your multi-language mastery and proving you&#39;re refactoring your way to üöÄ full-stack greatness with 60% of the questline conquered!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>