<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Polyglot MCP Services Architecture - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-developer">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/Azure-Samples/azure-ai-travel-agents" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">AI Travel Agents: Multi-Agent Orchestration with MCP and LlamaIndex</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Polyglot MCP Services Architecture</h1>
<hr>
<p>The AI Travel Agents application showcases a cutting-edge polyglot architecture that leverages MCP (Model Context Protocol) services implemented in Python, Java, TypeScript, and .NET. These services, each tailored to specific functionalities like destination recommendation, itinerary planning, and echo ping, demonstrate seamless integration across diverse programming languages. This quest explores the modular and scalable design of MCP services, emphasizing dynamic tool discovery, service orchestration, and cross-language compatibility. Dive deep into the implementation details to uncover the secrets of this robust architecture.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Tool Annotation Analysis</strong>: How do annotations like <code class="inline-code">@Tool</code> in Java and <code class="inline-code">@mcp.tool()</code> in Python define and expose MCP tools for dynamic discovery?</li>
<li>‚ö° <strong>Service Initialization</strong>: How do MCP servers initialize and register tools in different languages (e.g., Spring Boot in Java, FastMCP in Python)?</li>
<li>üõ°Ô∏è <strong>Error Handling Patterns</strong>: What mechanisms are used to validate inputs and handle errors across the polyglot services?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java" target="_blank" rel="noopener noreferrer">src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java</a>:</span> Destination Recommendation Service</h3>
<p>This file defines the <code class="inline-code">DestinationService</code> class, which provides travel destination recommendations based on various criteria. The service uses <code class="inline-code">@Tool</code> annotations to expose methods as MCP tools for dynamic discovery. Key highlights:</p>
<ul>
<li><code class="inline-code">echoMessage</code>: A simple tool to echo back input messages, demonstrating basic MCP functionality.</li>
<li><code class="inline-code">getDestinationsByActivity</code>: Recommends destinations based on activity type, with input validation to ensure correctness.</li>
<li><code class="inline-code">getDestinationsByPreferences</code>: Combines multiple criteria (activity, budget, season, family-friendly) to provide tailored recommendations.</li>
</ul>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/McpServerApplication.java" target="_blank" rel="noopener noreferrer">src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/McpServerApplication.java</a>:</span> Java MCP Server Initialization</h3>
<p>This file initializes the MCP server using Spring Boot. It registers the <code class="inline-code">DestinationService</code> tools for dynamic discovery. Key highlights:</p>
<ul>
<li><code class="inline-code">main</code>: Entry point for the application, bootstrapping the Spring Boot server.</li>
<li><code class="inline-code">destinationTools</code>: Registers the <code class="inline-code">DestinationService</code> tools using <code class="inline-code">MethodToolCallbackProvider</code>.</li>
</ul>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts" target="_blank" rel="noopener noreferrer">src/tools/echo-ping/src/server.ts</a>:</span> TypeScript Echo MCP Server</h3>
<p>This file implements an MCP server in TypeScript, exposing tools for echo functionality. Key highlights:</p>
<ul>
<li><code class="inline-code">setupServerRequestHandlers</code>: Configures MCP tool discovery and execution handlers.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts#L37" target="_blank" rel="noopener noreferrer"><code class="inline-code">handlePostRequest</code></a>: Processes incoming POST requests and handles tool execution.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts#L137" target="_blank" rel="noopener noreferrer"><code class="inline-code">createRPCErrorResponse</code></a>: Provides structured error responses for invalid requests.</li>
</ul>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a>:</span> Python Itinerary Planning Service</h3>
<p>This file defines a FastMCP-based server for itinerary planning. It exposes tools for hotel and flight suggestions. Key highlights:</p>
<ul>
<li><code class="inline-code">suggest_hotels</code>: Generates hotel suggestions based on location and dates, with input validation.</li>
<li><code class="inline-code">suggest_flights</code>: Provides flight suggestions, including direct and connecting flights, based on travel dates and locations.</li>
<li><code class="inline-code">validate_iso_date</code>: Ensures date inputs conform to ISO format and raises errors for invalid inputs.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java" target="_blank" rel="noopener noreferrer">src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/service/DestinationService.java</a></h3>
<pre><code class="language-java">@Tool(description = &quot;Echo back the input message exactly as received&quot;)
public String echoMessage(String message) {
    return message;
}

@Tool(description = &quot;Get travel destination recommendations based on preferred activity type&quot;)
public String getDestinationsByActivity(String activityType) {
    try {
        String activity = activityType.toUpperCase();
        if (!isValidActivityType(activity)) {
            return &quot;Invalid activity type. Please use one of: BEACH, ADVENTURE, CULTURAL, RELAXATION, URBAN_EXPLORATION, NATURE, WINTER_SPORTS&quot;;
        }
        return getDestinationsByPreference(activity, null, null, null);
    } catch (Exception e) {
        return &quot;Invalid activity type. Please use one of: BEACH, ADVENTURE, CULTURAL, RELAXATION, URBAN_EXPLORATION, NATURE, WINTER_SPORTS&quot;;
    }
}
</code></pre>
<ul>
<li>Validates activity types to ensure input correctness.</li>
<li>Demonstrates dynamic tool exposure with <code class="inline-code">@Tool</code> annotations.</li>
<li>Provides hardcoded examples for simplicity and clarity.</li>
</ul>
<hr>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/McpServerApplication.java" target="_blank" rel="noopener noreferrer">src/tools/destination-recommendation/src/main/java/com/microsoft/mcp/sample/server/McpServerApplication.java</a></h3>
<pre><code class="language-java">@Bean
public ToolCallbackProvider destinationTools(DestinationService destinationService) {
    return MethodToolCallbackProvider.builder().toolObjects(destinationService).build();
}
</code></pre>
<ul>
<li>Registers tools dynamically from the <code class="inline-code">DestinationService</code> class.</li>
<li>Uses Spring Boot‚Äôs dependency injection for seamless initialization.</li>
<li>Enables modular tool discovery.</li>
</ul>
<hr>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/echo-ping/src/server.ts" target="_blank" rel="noopener noreferrer">src/tools/echo-ping/src/server.ts</a></h3>
<pre><code class="language-typescript">private setupServerRequestHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async (_request) =&gt; {
        return {
            jsonrpc: JSON_RPC,
            tools: EchoTools,
        };
    });
    this.server.setRequestHandler(
        CallToolRequestSchema,
        async (request, _extra) =&gt; {
            const args = request.params.arguments;
            const toolName = request.params.name;
            const tool = EchoTools.find((tool) =&gt; tool.name === toolName);

            if (!tool) {
                return this.createRPCErrorResponse(`Tool ${toolName} not found.`);
            }
            try {
                const result = await tool.execute(args as any);
                return {
                    jsonrpc: JSON_RPC,
                    content: [
                        {
                            type: &#39;text&#39;,
                            text: `Tool ${toolName} executed with arguments ${JSON.stringify(
                                args
                            )}. Result: ${JSON.stringify(result)}`,
                        },
                    ],
                };
            } catch (error) {
                return this.createRPCErrorResponse(
                    `Error executing tool ${toolName}: ${error}`
                );
            }
        }
    );
}
</code></pre>
<ul>
<li>Implements dynamic tool discovery with <code class="inline-code">ListToolsRequestSchema</code>.</li>
<li>Handles tool execution and provides structured responses.</li>
<li>Demonstrates robust error handling for invalid tool requests.</li>
</ul>
<hr>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/tools/itinerary-planning/src/mcp_server.py" target="_blank" rel="noopener noreferrer">src/tools/itinerary-planning/src/mcp_server.py</a></h3>
<pre><code class="language-python">@mcp.tool()
async def suggest_hotels(
    location: Annotated[str, Field(description=&quot;Location (city or area) to search for hotels&quot;)],
    check_in: Annotated[str, Field(description=&quot;Check-in date in ISO format (YYYY-MM-DD)&quot;)],
    check_out: Annotated[str, Field(description=&quot;Check-out date in ISO format (YYYY-MM-DD)&quot;)],
) -&gt; HotelSuggestions:
    check_in_date = validate_iso_date(check_in, &quot;check_in&quot;)
    check_out_date = validate_iso_date(check_out, &quot;check_out&quot;)

    if check_out_date &lt;= check_in_date:
        raise ValueError(&quot;check_out date must be after check_in date&quot;)

    hotel_types = [&quot;Luxury&quot;, &quot;Boutique&quot;, &quot;Budget&quot;, &quot;Business&quot;]
    amenities = [&quot;Free WiFi&quot;, &quot;Pool&quot;, &quot;Spa&quot;, &quot;Gym&quot;, &quot;Restaurant&quot;, &quot;Bar&quot;, &quot;Room Service&quot;, &quot;Parking&quot;]
    hotels = []

    for i in range(random.randint(3, 8)):
        hotel = Hotel(
            name=f&quot;{random.choice(hotel_types)} Hotel&quot;,
            address=fake.street_address(),
            location=f&quot;{random.choice([&#39;Downtown&#39;, &#39;Historic District&#39;])}, {location}&quot;,
            rating=round(random.uniform(3.0, 5.0), 1),
            price_per_night=random.randint(80, 500),
            hotel_type=random.choice(hotel_types),
            amenities=random.sample(amenities, random.randint(3, 6)),
            available_rooms=random.randint(1, 15),
        )
        hotels.append(hotel)

    hotels.sort(key=lambda x: x.rating, reverse=True)
    return HotelSuggestions(hotels=hotels)
</code></pre>
<ul>
<li>Validates date inputs to ensure ISO format compliance.</li>
<li>Generates mock hotel data dynamically based on input parameters.</li>
<li>Demonstrates Python‚Äôs <code class="inline-code">dataclass</code> for structured responses.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Annotation Usage</strong>: Pay attention to how <code class="inline-code">@Tool</code> and <code class="inline-code">@mcp.tool()</code> annotations simplify tool registration.</li>
<li><strong>Cross-Language Patterns</strong>: Compare initialization and validation patterns across Java, Python, and TypeScript implementations.</li>
<li><strong>Error Handling</strong>: Look for consistent error handling mechanisms, such as input validation and structured error responses.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the AI Travel Agents application.</p>
<p>Congratulations on successfully deploying a scalable, polyglot microservices architecture‚Äîyou&#39;re 60% through the quest chain and refactoring your way to full-stack mastery! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>