<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: MCP Protocol Integration & Tool Discovery - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-developer">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/Azure-Samples/azure-ai-travel-agents" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Multi-Agent Orchestration with Azure AI Travel Agents</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: MCP Protocol Integration &amp; Tool Discovery</h1>
<hr>
<p>The Azure AI Travel Agents application relies on the Model Context Protocol (MCP) to enable seamless collaboration between AI agents and tools. This quest dives into the MCP client implementations, exploring how tools are dynamically discovered, connected, and invoked. By understanding these integrations, developers can extend and enhance the system&#39;s capabilities across diverse programming environments.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Tool Discovery Mechanism</strong>: How does the <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L31" target="_blank" rel="noopener noreferrer"><code class="inline-code">mcpToolsList</code></a> function dynamically connect to MCP servers and retrieve available tools?</li>
<li>‚ö° <strong>Client Transport Selection</strong>: What determines whether the system uses HTTP or SSE for MCP client communication?</li>
<li>üõ°Ô∏è <strong>Error Handling in Connectivity</strong>: How does the system handle errors when connecting to MCP servers or invoking tools?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-http-client.ts" target="_blank" rel="noopener noreferrer">src/api/src/mcp/mcp-http-client.ts</a>:</span> HTTP-based MCP client implementation</h3>
<p>This file defines the <code class="inline-code">MCPClient</code> class, which establishes communication with MCP servers using HTTP. It supports tool discovery, invocation, and notification handling via the Streamable HTTP transport.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L39" target="_blank" rel="noopener noreferrer"><code class="inline-code">connect</code></a>: Establishes a connection to the MCP server using HTTP transport and logs the status.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L57" target="_blank" rel="noopener noreferrer"><code class="inline-code">listTools</code></a>: Retrieves the list of available tools from the MCP server.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L68" target="_blank" rel="noopener noreferrer"><code class="inline-code">callTool</code></a>: Invokes a specific tool on the server with provided arguments.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-http-client.ts" target="_blank" rel="noopener noreferrer">src/api/src/mcp/mcp-http-client.ts</a></h3>
<pre><code class="language-typescript">async connect() {
    await this.client.connect(this.transport);
    console.log(&#39;Connected to server&#39;);
}

async listTools() {
    const result = await this.client.listTools();
    return result.tools;
}

async callTool(name: string, toolArgs: string) {
    console.log(`Calling tool ${name} with arguments:`, toolArgs);

    return await this.client.callTool({
      name,
      arguments: JSON.parse(toolArgs),
    });
}
</code></pre>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L39" target="_blank" rel="noopener noreferrer"><code class="inline-code">connect</code></a>: Initializes the connection using the HTTP transport and ensures the client is ready for communication.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L57" target="_blank" rel="noopener noreferrer"><code class="inline-code">listTools</code></a>: Queries the MCP server for available tools, demonstrating dynamic discovery capabilities.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L68" target="_blank" rel="noopener noreferrer"><code class="inline-code">callTool</code></a>: Sends requests to invoke specific tools, showcasing how arguments are parsed and passed.</li>
</ul>
<hr>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts" target="_blank" rel="noopener noreferrer">src/api/src/mcp/mcp-sse-client.ts</a>:</span> SSE-based MCP client implementation</h3>
<p>This file provides an alternative MCP client implementation using Server-Sent Events (SSE). It includes legacy support for tool discovery and invocation.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L39" target="_blank" rel="noopener noreferrer"><code class="inline-code">connect</code></a>: Establishes a connection to the MCP server using SSE transport and logs errors if connectivity fails.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L57" target="_blank" rel="noopener noreferrer"><code class="inline-code">listTools</code></a>: Fetches the list of tools from the server and updates the local tools cache.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L68" target="_blank" rel="noopener noreferrer"><code class="inline-code">callTool</code></a>: Invokes server tools with structured arguments, leveraging the SSE transport.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts" target="_blank" rel="noopener noreferrer">src/api/src/mcp/mcp-sse-client.ts</a></h3>
<pre><code class="language-typescript">connect() {
    return tracer.startActiveSpan(&quot;connect&quot;, async (span) =&gt; {
      log(&quot;Connecting to MCP SSE server&quot;);
      try {
        await this.client.connect(this.transport);
        log(&quot;Connected to MCP SSE server&quot;);
        span.end();
        return this.client;
      } catch (error: any) {
        log(&quot;Error connecting to MCP SSE server:&quot;, error);
        span.setStatus({ code: 2, message: (error as Error).message });
        span.end();
        throw new Error(
          `Failed to connect to MCP SSE server: ${(error as Error).message}`
        );
      }
    });
}

async listTools() {
    return tracer.startActiveSpan(&quot;listTools&quot;, async (span) =&gt; {
      log(&quot;Tools&quot;, this.tools);
      const toolsResult = await this.client.listTools();
      this.tools = toolsResult.tools;
      log(&quot;Tools: &quot;, toolsResult);
      span.end();
      return toolsResult;
    });
}

async callTool(toolName: string, args: Record&lt;string, any&gt;) {
    console.log(`Called ${toolName} with params:`, args);
    return tracer.startActiveSpan(&quot;processQuery&quot;, async (span) =&gt; {
      log(&quot;Tools&quot;, this.tools);

      const toolResult = await this.client.callTool({
        name: toolName,
        arguments: args,
      });

      log(&quot;Tool result&quot;, toolResult);
      span.end();
      return toolResult;
    });
}
</code></pre>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L39" target="_blank" rel="noopener noreferrer"><code class="inline-code">connect</code></a>: Uses OpenTelemetry tracing to monitor connectivity and logs errors for debugging.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L57" target="_blank" rel="noopener noreferrer"><code class="inline-code">listTools</code></a>: Demonstrates tool discovery with real-time updates to the local cache.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L68" target="_blank" rel="noopener noreferrer"><code class="inline-code">callTool</code></a>: Handles tool invocation, showcasing structured arguments and tracing integration.</li>
</ul>
<hr>
<h3><span class="header-prefix"><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts" target="_blank" rel="noopener noreferrer">src/api/src/mcp/mcp-tools.ts</a>:</span> MCP tool discovery and client initialization</h3>
<p>This file orchestrates the MCP client setup and tool discovery process, dynamically selecting the appropriate transport (HTTP or SSE) based on configuration.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L19" target="_blank" rel="noopener noreferrer"><code class="inline-code">client</code></a>: Initializes the MCP client based on the specified transport type (HTTP or SSE).</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L31" target="_blank" rel="noopener noreferrer"><code class="inline-code">mcpToolsList</code></a>: Connects to multiple MCP servers, retrieves tools, and handles errors gracefully.</li>
<li><code class="inline-code">McpServerDefinition</code>: Defines the structure for MCP server configurations.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts" target="_blank" rel="noopener noreferrer">src/api/src/mcp/mcp-tools.ts</a></h3>
<pre><code class="language-typescript">function client(config: LlamaIndexMCPClientOptions): MCPSSEClient | MCPHTTPClient {
    console.log(`Initializing MCP client`);
    console.log(`Using configuration:`, {config});

    if (config.type === &quot;sse&quot;) {
        // legacy implementation using SSE
        return new MCPSSEClient(&quot;llamaindex-sse-client&quot;, config.url, config.accessToken);
    } else {
        return new MCPHTTPClient(&quot;llamaindex-http-client&quot;, config.url, config.accessToken);
    }
}

export async function mcpToolsList(config: McpServerDefinition[]) {
    return await Promise.all(
        config.map(async ({ id, name, config }) =&gt; {
            const { url, type } = config;
            const mcpClient = client(config);

            try {
                console.log(`Connecting to MCP server ${name} at ${url}`);
                await mcpClient.connect();
                console.log(`MCP server ${name} is reachable`);
                const tools = await mcpClient.listTools();

                console.log(`MCP server ${name} has ${tools.length} tools`);
                return {
                    id,
                    name,
                    url,
                    type,
                    reachable: true,
                    selected: id !== &quot;echo-ping&quot;,
                    tools,
                };
            } catch (error: unknown) {
                console.error(
                    `MCP server ${name} is not reachable`,
                    (error as Error).message
                );
                return {
                    id,
                    name,
                    url,
                    type,
                    reachable: false,
                    selected: false,
                    tools: [],
                    error: (error as Error).message,
                };
            }
        })
    );
}
</code></pre>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L19" target="_blank" rel="noopener noreferrer"><code class="inline-code">client</code></a>: Dynamically selects the MCP client type based on the configuration, enabling flexible transport options.</li>
<li><a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L31" target="_blank" rel="noopener noreferrer"><code class="inline-code">mcpToolsList</code></a>: Iterates through MCP server definitions, connects to each server, and retrieves tools while handling errors gracefully.</li>
<li><code class="inline-code">McpServerDefinition</code>: Provides a structured approach to defining MCP server configurations, ensuring consistency.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use the <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-sse-client.ts#L39" target="_blank" rel="noopener noreferrer"><code class="inline-code">connect</code></a> method to establish communication with MCP servers before invoking tools.</li>
<li>Compare the HTTP and SSE transports to understand their differences and use cases.</li>
<li>Study the error handling in <a href="https://github.com/Azure-Samples/azure-ai-travel-agents/blob/main/src/api/src/mcp/mcp-tools.ts#L31" target="_blank" rel="noopener noreferrer"><code class="inline-code">mcpToolsList</code></a> to implement robust connectivity checks for MCP servers.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Congratulations on successfully deploying Quest 3: MCP Protocol Integration &amp; Tool Discovery‚Äîyour codebase just leveled up with precision-engineered interoperability and groundbreaking toolchain insights; onward to 100% completion! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>